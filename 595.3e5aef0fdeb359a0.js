"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[595],{5595:(R,I,s)=>{s.r(I),s.d(I,{SaleModule:()=>Pt});var v=s(6814),a=s(95),x=s(9664),q=s(6068),Z=s(707),S=s(4480),D=s(4104),U=s(6340),w=s(6022),P=s(3714),E=s(6218),u=s(2160),A=s(1865),_=s(354),f=s(7213),T=s(9862),k=s(8712),N=s(5722),M=s(8672),c=s(1712),h=s(3514),p=s(4444),t=s(4946);let m=(()=>{class o{constructor(e){this.httpClient=e,this.baseUrl=p.D.url,this.endpointListar="/ventasListar",this.endpointProductsGet="/getDatosVentasCrear",this.endpointVentasCrear="/crearVenta",this.endpointVentasDelete="/eliminarVenta"}getAll(e,n="",i=1){const l={headers:new T.WM({"Content-Type":"application/json"})};return this.httpClient.post(`${this.baseUrl+this.endpointListar}?per_page=${e}&page=${i}&search=${n}`,l)}deleteSale(e){return this.httpClient.post(`${this.baseUrl+this.endpointVentasDelete}`,e)}getDatosVentasCrear(){return this.httpClient.get(`${this.baseUrl+this.endpointProductsGet}`)}createVentas(e){return this.httpClient.post(`${this.baseUrl+this.endpointVentasCrear}`,e)}static#t=this.\u0275fac=function(n){return new(n||o)(t.LFG(T.eN))};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var g=s(86),O=s(3519),y=s.n(O),F=s(3859),Q=s(5219);function $(o,d){if(1&o){const e=t.EpF();t.TgZ(0,"div",21),t._UZ(1,"span"),t.TgZ(2,"span",22)(3,"form",23)(4,"div",24)(5,"input",25),t.NdJ("input",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.searchInput())}),t.qZA(),t.TgZ(6,"button",26),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.search(i.dt))}),t.qZA()()()()()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("formGroup",e.formSearch)}}function G(o,d){1&o&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"Hotel"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Usuario"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Total"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Subtotal"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Total Impuestos"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Estado"),t.qZA(),t.TgZ(13,"th"),t._uU(14,"Acciones"),t.qZA()())}function j(o,d){if(1&o){const e=t.EpF();t.TgZ(0,"p-button",30),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,l=t.oxw();return t.KtG(l.confirmDelete(i.id))}),t.qZA()}}function H(o,d){if(1&o&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td",27),t.YNc(14,j,1,0,"p-button",28),t.TgZ(15,"button",29),t._uU(16,"."),t.qZA()()()),2&o){const e=d.$implicit,n=t.oxw();t.xp6(2),t.Oqu(e.hotel.nombre),t.xp6(2),t.Oqu(e.usuario.usuario),t.xp6(2),t.Oqu(e.total),t.xp6(2),t.Oqu(e.subtotal),t.xp6(2),t.Oqu(e.total_impuestos),t.xp6(2),t.Oqu(n.getEstado(e.estado_id)),t.xp6(2),t.Q6J("ngIf",0!==e.estado_id||n.permisoEliminar)}}function z(o,d){1&o&&(t.TgZ(0,"tr")(1,"td",31),t._uU(2,"Cargando informacion porfavor espere ..."),t.qZA()())}const K=function(){return{"min-width":"50rem"}},W=function(){return["nombre","Hotel","acciones"]};let X=(()=>{class o{constructor(e,n,i,l,r){this.FB=e,this.spinner=n,this.SaleService=i,this.router=l,this.layoutService=r,this.loadingTable=!1,this.pageCount=10,this.pageActual=1,this.ultimaPage=1,this.disablePageLeft=!1,this.disablePageRight=!1,this.first=0,this.rows=8}ngOnInit(){this.buildForm(),this.getIndex()}buildForm(){this.formSearch=this.FB.group({search:["",[]]})}redirectToCrearVenta(){this.router.navigate(["dashboard/dashboardSell/sale-detail"])}getEstado(e){switch(e){case 1:return"Activa";case 0:return"Anulada";default:return"Desconocido"}}getIndex(e="",n=this.pageCount,i=1){this.spinner.show(),this.loadingTable=!0,this.SaleService.getAll(n,e,i).subscribe(l=>{this.loadingTable=!1,this.salesData=l.data,this.countRegisters=l.total,this.ultimaPage=l.last_page,l.total>n&&(this.disablePageRight=!0),this.validatePage(),this.spinner.hide()},l=>{console.log("Error: ",l),this.spinner.hide()})}confirmDelete(e){y().fire({title:"\xbfEstas seguro que deseas anular esta venta?",text:"Ten cuidado esta acci\xf3n no se prodr\xe1 reversar",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xed, Confirmar",cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&(this.spinner.show(),this.SaleService.deleteSale({id:e}).subscribe(i=>{this.spinner.hide(),"success"==i.code?(y().fire({title:"Exito",text:"Venta anulada exitosamente.",icon:"success"}),this.getIndex(),this.layoutService.reloadComponent()):y().fire({title:"Error",text:"Error al anular la venta.",icon:"error"})},i=>{console.log("Error: ",i)}))})}onPage(e){this.pageCount=e.rows,this.getIndex("",this.pageCount)}searchInput(){let e=this.formSearch.get("search").value;""==e&&this.getIndex(e)}search(e){let n=this.formSearch.get("search").value;this.getIndex(n)}onPageChange(e){this.first=e.first,this.rows=e.rows}leftTable(){this.pageActual=this.pageActual-1,this.getIndex("",this.pageCount,this.pageActual),this.validatePage()}rightTable(){this.pageActual=this.pageActual+1,this.getIndex("",this.pageCount,this.pageActual),this.validatePage()}validatePage(){1==this.pageActual&&(this.disablePageLeft=!1),this.pageActual>1&&(this.disablePageLeft=!0),this.ultimaPage==this.pageActual&&(this.disablePageRight=!1),this.ultimaPage>this.pageActual&&(this.disablePageRight=!0)}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(a.qu),t.Y36(M.t2),t.Y36(m),t.Y36(g.F0),t.Y36(F.P))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-sale"]],decls:24,vars:11,consts:[["type","ball-scale-multiple"],[1,"surface-section","px-4","py-5","md:px-6","lg:px-8"],[1,"flex","align-items-start","flex-column","lg:justify-content-between","lg:flex-row"],[1,"font-medium","text-3xl","text-900"],[1,"flex","align-items-center","text-700","flex-wrap"],[1,"mr-5","flex","align-items-center","mt-3"],[1,"mt-3","lg:mt-0"],["pButton","","pRipple","","label","Crear","icon","",1,"p-button-outlined","mr-2",3,"click"],[1,"grid","mt-3"],[1,"col-12"],[1,"card","px-3","py-3"],["responsiveLayout","scroll","selectionMode","multiple","dataKey","usuario",3,"value","tableStyle","loading","rows","globalFilterFields","rowHover","onPage"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","loadingbody"],[2,"text-align","center"],[1,"p-buttonset"],["pButton","","pRipple","","label","","icon","pi pi-arrow-left",3,"disabled","click"],["pButton","","pRipple","",3,"label"],["pButton","","pRipple","","label","","icon","pi pi-arrow-right",3,"disabled","click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[3,"formGroup"],[1,"p-inputgroup"],["formControlName","search","pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto",3,"input"],["type","button","pButton","","pRipple","",1,"pi","pi-search",3,"click"],[1,"flex","gap-1"],["icon","pi pi-trash","severity","danger",3,"click",4,"ngIf"],["disabled","",2,"visibility","hidden"],["icon","pi pi-trash","severity","danger",3,"click"],["colspan","8"]],template:function(n,i){1&n&&(t._UZ(0,"ngx-spinner",0),t.TgZ(1,"div",1)(2,"div",2)(3,"div")(4,"div",3),t._uU(5,"Ventas"),t.qZA(),t.TgZ(6,"div",4),t._UZ(7,"div",5),t.qZA()(),t.TgZ(8,"div",6)(9,"button",7),t.NdJ("click",function(){return i.redirectToCrearVenta()}),t.qZA()()()(),t.TgZ(10,"div",8)(11,"div",9)(12,"div",10)(13,"p-table",11),t.NdJ("onPage",function(r){return i.onPage(r)}),t.YNc(14,$,7,1,"ng-template",12),t.YNc(15,G,15,0,"ng-template",13),t.YNc(16,H,17,7,"ng-template",14),t.YNc(17,z,3,0,"ng-template",15),t.qZA(),t._UZ(18,"br"),t.TgZ(19,"div",16)(20,"span",17)(21,"button",18),t.NdJ("click",function(){return i.leftTable()}),t.qZA(),t._UZ(22,"button",19),t.TgZ(23,"button",20),t.NdJ("click",function(){return i.rightTable()}),t.qZA()()()()()()),2&n&&(t.xp6(13),t.Q6J("value",i.salesData)("tableStyle",t.DdM(9,K))("loading",i.loadingTable)("rows",8)("globalFilterFields",t.DdM(10,W))("rowHover",!0),t.xp6(8),t.Q6J("disabled",!i.disablePageLeft),t.xp6(1),t.Q6J("label",i.pageActual),t.xp6(1),t.Q6J("disabled",!i.disablePageRight))},dependencies:[v.O5,x.iA,Q.jx,Z.Hq,Z.zx,a._Y,a.Fj,a.JJ,a.JL,S.H,P.o,a.sg,a.u,M.Ro]})}return o})();var V=s(2506),Y=s(4055),B=s(6263);function tt(o,d){if(1&o&&(t.TgZ(0,"div",3)(1,"span",50),t._uU(2),t.qZA()()),2&o){const e=d.$implicit;t.xp6(2),t.lnq(" ",e.numero_documento," ",e.nombres," ",e.apellidos,"")}}function et(o,d){1&o&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"Categor\xeda"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Valor"),t.qZA()())}function it(o,d){if(1&o&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"currency"),t.qZA()()),2&o){const e=d.$implicit;t.xp6(2),t.Oqu(e.nombre),t.xp6(2),t.Oqu(t.gM2(5,2,e.total,"COP","symbol-narrow","1.0-0"))}}function ot(o,d){1&o&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"Nombre"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Cantidad"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Subtotal"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Total"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Acciones"),t.qZA()())}function nt(o,d){if(1&o){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"currency"),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.ALo(10,"currency"),t.qZA(),t.TgZ(11,"td")(12,"p-button",51),t.NdJ("click",function(){const l=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.eliminarProducto(l))}),t.qZA()()()}if(2&o){const e=d.$implicit;t.xp6(2),t.Oqu(e.nombre),t.xp6(2),t.Oqu(e.cantidad),t.xp6(2),t.Oqu(t.gM2(7,4,e.subtotal,"COP","symbol-narrow","1.0-0")),t.xp6(3),t.Oqu(t.gM2(10,9,e.total,"COP","symbol-narrow","1.0-0"))}}function at(o,d){1&o&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"Nombre"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Cantidad"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Subtotal"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Total"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Acciones"),t.qZA()())}function rt(o,d){if(1&o){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"currency"),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.ALo(10,"currency"),t.qZA(),t.TgZ(11,"td")(12,"p-button",51),t.NdJ("click",function(){const l=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.eliminarReceta(l))}),t.qZA()()()}if(2&o){const e=d.$implicit;t.xp6(2),t.Oqu(e.nombre),t.xp6(2),t.Oqu(e.cantidad),t.xp6(2),t.Oqu(t.gM2(7,4,e.subtotal,"COP","symbol-narrow","1.0-0")),t.xp6(3),t.Oqu(t.gM2(10,9,e.total,"COP","symbol-narrow","1.0-0"))}}function lt(o,d){if(1&o&&(t.TgZ(0,"div",3)(1,"span",50),t._uU(2),t.qZA(),t._UZ(3,"p-tag",52)(4,"p-tag",52),t.qZA()),2&o){const e=d.$implicit;t.xp6(2),t.Oqu(e.nombre),t.xp6(1),t.MGl("value","$",e.precio,""),t.xp6(1),t.MGl("value","Stock:",e.stockActual,"")}}function st(o,d){1&o&&(t.TgZ(0,"div",53),t._uU(1,"Campo requerido"),t.qZA())}function ct(o,d){1&o&&(t.TgZ(0,"div",53),t._uU(1,"Campo requerido "),t.qZA())}function pt(o,d){1&o&&(t.TgZ(0,"div",53),t._uU(1,"La cantidad debe ser al menos 1."),t.qZA())}function dt(o,d){1&o&&(t.TgZ(0,"div",54),t._uU(1," La cantidad excede el stock disponible. "),t.qZA())}function ut(o,d){if(1&o&&(t.TgZ(0,"div",3)(1,"span",50),t._uU(2),t.qZA(),t._UZ(3,"p-tag",52)(4,"p-tag",52),t.qZA()),2&o){const e=d.$implicit;t.xp6(2),t.Oqu(e.nombre),t.xp6(1),t.MGl("value","$",e.precio,""),t.xp6(1),t.MGl("value","Stock:",e.stockActual,"")}}function gt(o,d){1&o&&(t.TgZ(0,"div",53),t._uU(1,"Campo requerido"),t.qZA())}function mt(o,d){1&o&&(t.TgZ(0,"div",53),t._uU(1,"Campo requerido"),t.qZA())}function _t(o,d){1&o&&(t.TgZ(0,"div",53),t._uU(1,"La cantidad debe ser al menos 1."),t.qZA())}function ft(o,d){1&o&&(t.TgZ(0,"div",54),t._uU(1,"La cantidad excede el stock disponible."),t.qZA())}function ht(o,d){if(1&o&&(t.TgZ(0,"div",3)(1,"span",50),t._uU(2),t.qZA()()),2&o){const e=d.$implicit;t.xp6(2),t.Oqu(e.nombre)}}function vt(o,d){1&o&&(t.TgZ(0,"div",53),t._uU(1,"Campo requerido"),t.qZA())}function Tt(o,d){1&o&&(t.TgZ(0,"div",53),t._uU(1,"Campo requerido"),t.qZA())}function bt(o,d){1&o&&(t.TgZ(0,"div",53),t._uU(1,"El valor debe ser al menos 1."),t.qZA())}function Ct(o,d){if(1&o){const e=t.EpF();t.TgZ(0,"div",61)(1,"p-button",62),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().index,l=t.oxw();return t.KtG(l.eliminarMetodoPago(i))}),t.qZA()()}}function xt(o,d){if(1&o&&(t.TgZ(0,"div",55)(1,"div",9)(2,"div",56)(3,"label"),t._uU(4,"M\xe9todo de Pago"),t.qZA(),t.TgZ(5,"p-dropdown",57),t.YNc(6,ht,3,1,"ng-template",14),t.qZA(),t.YNc(7,vt,2,0,"div",34),t.qZA(),t.TgZ(8,"div",58)(9,"label"),t._uU(10,"Valor"),t.qZA(),t._UZ(11,"input",59),t.YNc(12,Tt,2,0,"div",34),t.YNc(13,bt,2,0,"div",34),t.qZA(),t.YNc(14,Ct,2,0,"div",60),t.qZA()()),2&o){const e=d.$implicit,n=d.index,i=t.oxw();t.Q6J("formGroupName",n),t.xp6(5),t.Q6J("options",i.dataMetodosPago)("autoDisplayFirst",!1),t.xp6(2),t.Q6J("ngIf",e.get("metodo_pago_id").hasError("required")),t.xp6(5),t.Q6J("ngIf",e.get("valor").hasError("required")),t.xp6(1),t.Q6J("ngIf",null==e.get("valor").errors?null:e.get("valor").errors.min),t.xp6(1),t.Q6J("ngIf",i.metodosPago.controls.length>1)}}const Zt=function(){return{"min-width":"20rem"}},L=function(){return{"min-width":"50rem"}},J=function(){return{width:"50vw"}};let At=(()=>{class o{constructor(e,n,i,l,r){this.FB=e,this.spinner=n,this.saleService=i,this.router=l,this.layoutService=r,this.loadingTable=!1,this.clienteData=[],this.validacionStock=!1,this.productosAgregados=[],this.recetasAgregadas=[],this.totalProductos=0,this.totalRecetas=0,this.totalImpuestos=0,this.subtotal=0,this.total=0,this.totales=[{nombre:"Productos/Servicios",total:this.totalProductos},{nombre:"Recetas",total:this.totalRecetas},{nombre:"Impuestos",total:this.totalImpuestos},{nombre:"Subtotal",total:this.subtotal},{nombre:"Total",total:this.total}],this.recetasData=[],this.displayModalRecipes=!1,this.productsData=[],this.displayModalProducts=!1,this.dataMetodosPago=[],this.displayModalMetodosPago=!1,this.buildForm()}ngOnInit(){this.spinner.hide(),this.buildForm(),this.loadData()}buildForm(){this.form=this.FB.group({cliente_id:[null]}),this.formProducto=this.FB.group({producto_id:[null,a.kI.required],cantidad:[1,[a.kI.required,a.kI.min(1)]]}),this.formReceta=this.FB.group({receta_id:[null,a.kI.required],cantidad:[1,[a.kI.required,a.kI.min(1)]]}),this.formMetodoPago=this.FB.group({metodos_pago:this.FB.array([this.crearGrupoMetodoPago()])})}openModalProducts(){this.displayModalProducts=!0,this.validacionStock=!1}openModalRecipes(){this.displayModalRecipes=!0,this.validacionStock=!1}openModalMediosPagos(){this.displayModalMetodosPago=!0}crearGrupoMetodoPago(){return this.FB.group({metodo_pago_id:[null,a.kI.required],valor:[null,[a.kI.required,a.kI.min(1)]]})}get metodosPago(){return this.formMetodoPago.get("metodos_pago")}agregarMetodoPago(){this.metodosPago.push(this.crearGrupoMetodoPago())}eliminarMetodoPago(e){this.metodosPago.removeAt(e)}get totalMetodosPago(){return this.metodosPago.controls.map(e=>e.get("valor").value).reduce((e,n)=>e+n,0)}get cambio(){const e=this.totalMetodosPago,n=this.total;return e>n?e-n:0}submitFactura(){this.formMetodoPago.valid&&(this.displayModalMetodosPago=!1,this.calcularTotales())}loadData(){this.saleService.getDatosVentasCrear().subscribe(e=>{this.productsData=e.productos.map(n=>({...n,tipo_servicio_id:1===n.tipo_producto?1:2})),this.recetasData=e.recetas.map(n=>({...n,tipo_servicio_id:4})),this.clienteData=e.clientes,this.dataMetodosPago=e.metodosPago},e=>{console.error(e)})}agregarProductos(){const e=this.formProducto.get("producto_id").value,n=this.formProducto.get("cantidad").value;if(e&&null!=n){const i=this.productsData.find(C=>C.id===e.id);if(i&&n>i.stockActual)return void(this.validacionStock=!0);this.validacionStock=!1;const l=parseFloat(e.precio),r=l*n+l*n*e.impuestos_total/100,b={...e,cantidad:n,subtotal:l,total:r,impuestos:l*n*e.impuestos_total/100};this.productosAgregados.push(b),this.calcularTotales(),this.displayModalProducts=!1,this.formProducto.reset()}else console.error(`No se encontr\xf3 el producto con id ${e.id} en productsData`)}eliminarProducto(e){const n=this.productosAgregados.indexOf(e);n>-1&&this.productosAgregados.splice(n,1),this.calcularTotales()}onCantidadChange(e){this.formProducto.controls.cantidad.setValue(e.target.value)}agregarRecetas(){const e=this.formReceta.get("receta_id").value,n=this.formReceta.get("cantidad").value;if(e&&null!=n){const i=this.recetasData.find(C=>C.id===e.id);if(i&&n>i.stockActual)return void(this.validacionStock=!0);this.validacionStock=!1;const l=parseFloat(e.precio),r=l*n+l*n*e.impuestos_total/100,b={...e,cantidad:n,subtotal:l,total:r,impuestos:l*n*e.impuestos_total/100};this.recetasAgregadas.push(b),this.calcularTotales(),this.displayModalRecipes=!1,this.formReceta.reset()}else console.error(`No se encontr\xf3 la receta con id ${e.id} en recetasData`)}eliminarReceta(e){const n=this.recetasAgregadas.findIndex(i=>i.id===e.id);-1!==n?this.recetasAgregadas.splice(n,1):console.error(`No se encontr\xf3 la receta con id ${e.id} en recetasAgregadas`),this.calcularTotales()}calcularTotales(){this.totalProductos=this.productosAgregados.reduce((e,n)=>e+n.subtotal*n.cantidad,0),this.totalRecetas=this.recetasAgregadas.reduce((e,n)=>e+n.subtotal*n.cantidad,0),this.totalImpuestos=this.productosAgregados.reduce((e,n)=>e+n.subtotal*n.cantidad*n.impuestos_total/100,0)+this.recetasAgregadas.reduce((e,n)=>e+n.subtotal*n.cantidad*n.impuestos_total/100,0),this.subtotal=this.totalProductos+this.totalRecetas,this.total=this.subtotal+this.totalImpuestos,this.totales=[{nombre:"Productos/Servicios",total:this.totalProductos},{nombre:"Recetas",total:this.totalRecetas},{nombre:"Impuestos",total:this.totalImpuestos},{nombre:"Subtotal",total:this.subtotal},{nombre:"Total",total:this.total}]}crearVenta(){this.spinner.show();const e=[...this.productosAgregados,...this.recetasAgregadas];if(!Array.isArray(e))return this.spinner.hide(),void y().fire({title:"Error",text:"Hubo un error al preparar los detalles de la venta.",icon:"error"});let n={cliente_id:this.form.get("cliente_id").value?parseInt(this.form.get("cliente_id").value[0].id):null,total:this.total,subtotal:this.subtotal,total_impuestos:this.totalImpuestos,estado_id:1};const i=new FormData;for(const r in n)n.hasOwnProperty(r)&&i.append(r,n[r]);e.forEach((r,b)=>{r.consumo_id=r.id,delete r.id,r.valor_consumo=r.subtotal,delete r.subtotal,r.tipo_consumo=r.tipo_servicio_id,delete r.tipo_servicio_id,r.valor_impuesto=r.impuestos||0;for(const C in r)r.hasOwnProperty(C)&&i.append(`detalles_venta[${b}][${C}]`,r[C])}),this.formMetodoPago.get("metodos_pago").value.forEach((r,b)=>{for(const C in r)r.hasOwnProperty(C)&&i.append(`metodos_pago[${b}][${C}]`,"metodo_pago_id"===C?r[C].id:r[C])}),this.saleService.createVentas(i).subscribe(r=>{r.venta?(this.spinner.hide(),this.form.reset(),this.productosAgregados=[],this.recetasAgregadas=[],this.calcularTotales(),y().fire({title:"Exito",text:"Venta creada exitosamente.",icon:"success"}).then(()=>{this.router.navigate(["/dashboard/dashboardSell"])}),this.layoutService.reloadComponent()):"warning"===r.code?y().fire({title:"Advertencia",text:r.msm,icon:"warning"}):y().fire({title:"Error",text:"Error al crear la venta.",icon:"error"})},r=>{400===r.status&&r.error.error.startsWith("Stock insuficiente")?(this.spinner.hide(),y().fire({title:"Advertencia",text:r.error.error,icon:"warning"}),this.productosAgregados.forEach(b=>{b.subtotal=b.valor_consumo}),this.recetasAgregadas.forEach(b=>{b.subtotal=b.valor_consumo}),this.calcularTotales()):(this.spinner.hide(),console.error("Error:",r))})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(a.qu),t.Y36(M.t2),t.Y36(m),t.Y36(g.F0),t.Y36(F.P))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-sale-detail"]],decls:107,vars:77,consts:[["type","ball-scale-multiple"],[1,"surface-section","px-4","py-5","md:px-6","lg:px-8"],[1,"flex","align-items-center","lg:flex-row"],[1,"flex","align-items-center"],["pButton","","pRipple","","label","","icon","pi pi-arrow-left",1,"p-button-outlined","mr-4",3,"routerLink"],[1,"font-medium","text-3xl","text-900"],[1,"flex-grow-1","text-right"],["pButton","","pRipple","","label","Pagar","icon","",1,"p-button-outlined","mr-2",3,"click"],[1,"p-fluid","p-formgrid"],[1,"grid"],[1,"col-6","mt-4","ml-2"],[3,"formGroup"],["for","cliente"],["formControlName","cliente_id","selectionLimit","1","optionLabel","nombres","placeholder","Buscar cliente","display","chip","emptyMessage","Cliente no encontrado",1,"multiselect-custom",3,"options"],["pTemplate","item"],[1,"flex","align-items-start","flex-column","lg:justify-content-between","lg:flex-row"],[1,"mt-3","lg:mt-0"],["pButton","","pRipple","","label","Agregar Producto/Servicio","icon","",1,"p-button-outlined","mr-2",3,"click"],["pButton","","pRipple","","label","Agregar Receta","icon","",1,"p-button-outlined","mr-2",3,"click"],[1,"font-medium","text-3xl","text-500"],[1,"grid","mt-3"],[1,"col-12"],[1,"card","px-3","py-3"],[1,"col-4"],["responsiveLayout","scroll",3,"value","tableStyle","rows"],["pTemplate","header"],["pTemplate","body"],[1,"col-8"],[1,"mt-2"],["header","Agregar Producto/Servicio",3,"visible","modal","draggable","resizable","visibleChange"],[3,"formGroup","ngSubmit"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-6","md:col-6"],["formControlName","producto_id","optionLabel","nombre","placeholder","Buscar Producto o Servicio",1,"dropdown-custom",3,"options","autoDisplayFirst"],["style","color: red;",4,"ngIf"],["type","number","min","1","formControlName","cantidad","placeholder","Cantidad","pInputText","",1,"w-full","mb-3","border-round-3xl",3,"change"],["class","field col-12","style","color: red;",4,"ngIf"],[1,"field","col-12","md:col-12"],["pButton","","pRipple","","label","Agregar Producto","icon","pi pi-fw","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl"],["header","Agregar Receta",3,"visible","modal","draggable","resizable","visibleChange"],["formControlName","receta_id","optionLabel","nombre","placeholder","Buscar Receta",1,"dropdown-custom",3,"options","autoDisplayFirst"],["type","number","min","1","formControlName","cantidad","placeholder","Cantidad","pInputText","",1,"w-full","mb-3","border-round-3xl"],["pButton","","pRipple","","label","Agregar Receta","icon","pi pi-fw","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl"],["header","Facturar",3,"visible","modal","draggable","resizable","visibleChange"],["formArrayName","metodos_pago",1,"p-fluid","p-formgrid","grid"],["class","field col-12",3,"formGroupName",4,"ngFor","ngForOf"],[1,"field","col-12","flex","align-items-center"],["pRipple","","type","button","icon","pi pi-plus","severity","success",3,"click"],[1,"field","col-12"],["pButton","","pRipple","","label","Pagar","icon","",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl",3,"disabled","click"],[1,"ml-2"],["icon","pi pi-trash","severity","danger",3,"click"],[1,"padding",3,"value"],[2,"color","red"],[1,"field","col-12",2,"color","red"],[1,"field","col-12",3,"formGroupName"],[1,"col-6","md:col-5"],["formControlName","metodo_pago_id","optionLabel","nombre","placeholder","Buscar M\xe9todo de Pago",1,"dropdown-custom",3,"options","autoDisplayFirst"],[1,"col-4","md:col-5"],["type","number","min","1","formControlName","valor","placeholder","Valor","pInputText","",1,"w-full","mb-3","border-round-3xl"],["class","col-2 mt-4 eliminar-metodo-pago",4,"ngIf"],[1,"col-2","mt-4","eliminar-metodo-pago"],["pRipple","","type","button","icon","pi pi-trash","severity","danger",3,"click"]],template:function(n,i){1&n&&(t._UZ(0,"ngx-spinner",0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3),t._UZ(4,"button",4),t.TgZ(5,"div",5),t._uU(6,"Crear Venta"),t.qZA()(),t.TgZ(7,"div",6)(8,"button",7),t.NdJ("click",function(){return i.openModalMediosPagos()}),t.qZA()()(),t.TgZ(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"label",12),t._uU(14,"Cliente"),t.qZA(),t.TgZ(15,"div")(16,"p-multiSelect",13),t.YNc(17,tt,3,3,"ng-template",14),t.qZA()()()()()(),t.TgZ(18,"div",1)(19,"div",15)(20,"div",16)(21,"button",17),t.NdJ("click",function(){return i.openModalProducts()}),t.qZA()(),t.TgZ(22,"div",16)(23,"button",18),t.NdJ("click",function(){return i.openModalRecipes()}),t.qZA()(),t.TgZ(24,"div",19),t._uU(25),t.ALo(26,"currency"),t.qZA(),t.TgZ(27,"div",19),t._uU(28),t.ALo(29,"currency"),t.qZA()()()(),t.TgZ(30,"div",20)(31,"div",21)(32,"div",22)(33,"h3"),t._uU(34,"Detalle de Venta"),t.qZA(),t.TgZ(35,"div",9)(36,"div",23)(37,"p-table",24),t.YNc(38,et,5,0,"ng-template",25),t.YNc(39,it,6,7,"ng-template",26),t.qZA()(),t.TgZ(40,"div",27)(41,"p"),t._uU(42,"Productos/Servicios"),t.qZA(),t.TgZ(43,"p-table",24),t.YNc(44,ot,11,0,"ng-template",25),t.YNc(45,nt,13,14,"ng-template",26),t.qZA(),t.TgZ(46,"p",28),t._uU(47,"Recetas"),t.qZA(),t.TgZ(48,"p-table",24),t.YNc(49,at,11,0,"ng-template",25),t.YNc(50,rt,13,14,"ng-template",26),t.qZA()()()()()(),t.TgZ(51,"p-dialog",29),t.NdJ("visibleChange",function(r){return i.displayModalProducts=r}),t.TgZ(52,"div",21)(53,"form",30),t.NdJ("ngSubmit",function(){return i.agregarProductos()}),t.TgZ(54,"div",31)(55,"div",32)(56,"label"),t._uU(57,"Producto/Servicio"),t.qZA(),t.TgZ(58,"p-dropdown",33),t.YNc(59,lt,5,3,"ng-template",14),t.qZA(),t.YNc(60,st,2,0,"div",34),t.qZA(),t.TgZ(61,"div",32)(62,"label"),t._uU(63,"Cantidad"),t.qZA(),t.TgZ(64,"input",35),t.NdJ("change",function(r){return i.onCantidadChange(r)}),t.qZA(),t.YNc(65,ct,2,0,"div",34),t.YNc(66,pt,2,0,"div",34),t.YNc(67,dt,2,0,"div",36),t.qZA(),t.TgZ(68,"div",37),t._UZ(69,"button",38),t.qZA()(),t._UZ(70,"br"),t.qZA()()(),t.TgZ(71,"p-dialog",39),t.NdJ("visibleChange",function(r){return i.displayModalRecipes=r}),t.TgZ(72,"div",21)(73,"form",30),t.NdJ("ngSubmit",function(){return i.agregarRecetas()}),t.TgZ(74,"div",31)(75,"div",32)(76,"label"),t._uU(77,"Receta"),t.qZA(),t.TgZ(78,"p-dropdown",40),t.YNc(79,ut,5,3,"ng-template",14),t.qZA(),t.YNc(80,gt,2,0,"div",34),t.qZA(),t.TgZ(81,"div",32)(82,"label"),t._uU(83,"Cantidad"),t.qZA(),t._UZ(84,"input",41),t.YNc(85,mt,2,0,"div",34),t.YNc(86,_t,2,0,"div",34),t.YNc(87,ft,2,0,"div",36),t.qZA(),t.TgZ(88,"div",37),t._UZ(89,"button",42),t.qZA()(),t._UZ(90,"br"),t.qZA()()(),t.TgZ(91,"p-dialog",43),t.NdJ("visibleChange",function(r){return i.displayModalMetodosPago=r}),t.TgZ(92,"div",21)(93,"form",30),t.NdJ("ngSubmit",function(){return i.submitFactura()}),t.TgZ(94,"div",44),t.YNc(95,xt,15,7,"div",45),t.TgZ(96,"div",46)(97,"p-button",47),t.NdJ("click",function(){return i.agregarMetodoPago()}),t.qZA(),t.TgZ(98,"div",6)(99,"div",19),t._uU(100),t.ALo(101,"currency"),t.qZA(),t.TgZ(102,"div",19),t._uU(103),t.ALo(104,"currency"),t.qZA()()()(),t.TgZ(105,"div",48)(106,"button",49),t.NdJ("click",function(){return i.crearVenta()}),t.qZA()()()()()),2&n&&(t.xp6(4),t.Q6J("routerLink","/dashboard/dashboardSell"),t.xp6(8),t.Q6J("formGroup",i.form),t.xp6(4),t.Q6J("options",i.clienteData),t.xp6(9),t.hij("Total: ",t.gM2(26,51,i.total,"COP","symbol-narrow","1.0-0"),""),t.xp6(3),t.hij("Pagado: ",t.gM2(29,56,i.totalMetodosPago,"COP","symbol-narrow","1.0-0"),""),t.xp6(9),t.Q6J("value",i.totales)("tableStyle",t.DdM(71,Zt))("rows",8),t.xp6(6),t.Q6J("value",i.productosAgregados)("tableStyle",t.DdM(72,L))("rows",5),t.xp6(5),t.Q6J("value",i.recetasAgregadas)("tableStyle",t.DdM(73,L))("rows",5),t.xp6(3),t.Akn(t.DdM(74,J)),t.Q6J("visible",i.displayModalProducts)("modal",!0)("draggable",!1)("resizable",!1),t.xp6(2),t.Q6J("formGroup",i.formProducto),t.xp6(5),t.Q6J("options",i.productsData)("autoDisplayFirst",!1),t.xp6(2),t.Q6J("ngIf",i.formProducto.get("producto_id").hasError("required")),t.xp6(5),t.Q6J("ngIf",i.formProducto.get("cantidad").hasError("required")),t.xp6(1),t.Q6J("ngIf",null==i.formProducto.get("cantidad").errors?null:i.formProducto.get("cantidad").errors.min),t.xp6(1),t.Q6J("ngIf",i.validacionStock),t.xp6(4),t.Akn(t.DdM(75,J)),t.Q6J("visible",i.displayModalRecipes)("modal",!0)("draggable",!1)("resizable",!1),t.xp6(2),t.Q6J("formGroup",i.formReceta),t.xp6(5),t.Q6J("options",i.recetasData)("autoDisplayFirst",!1),t.xp6(2),t.Q6J("ngIf",i.formReceta.get("receta_id").hasError("required")),t.xp6(5),t.Q6J("ngIf",i.formReceta.get("cantidad").hasError("required")),t.xp6(1),t.Q6J("ngIf",null==i.formReceta.get("cantidad").errors?null:i.formReceta.get("cantidad").errors.min),t.xp6(1),t.Q6J("ngIf",i.validacionStock),t.xp6(4),t.Akn(t.DdM(76,J)),t.Q6J("visible",i.displayModalMetodosPago)("modal",!0)("draggable",!1)("resizable",!1),t.xp6(2),t.Q6J("formGroup",i.formMetodoPago),t.xp6(2),t.Q6J("ngForOf",i.metodosPago.controls),t.xp6(5),t.hij("Total a pagar: ",t.gM2(101,61,i.total,"COP","symbol-narrow","1.0-0"),""),t.xp6(3),t.hij("Pendiente: ",t.gM2(104,66,i.total-i.totalMetodosPago,"COP","symbol-narrow","1.0-0"),""),t.xp6(3),t.Q6J("disabled",i.totalMetodosPago<i.total||i.totalMetodosPago>i.total||0===i.total))},dependencies:[v.sg,v.O5,g.rH,x.iA,Q.jx,Z.Hq,Z.zx,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.qQ,S.H,P.o,u.Lt,f.V,a.sg,a.u,a.x0,a.CE,M.Ro,Y.NU,B.V,v.H9],styles:['@charset "UTF-8";.flex[_ngcontent-%COMP%]{display:flex;align-items:center}.flex-grow-1[_ngcontent-%COMP%]{flex-grow:1}.text-right[_ngcontent-%COMP%]{text-align:right}.mr-2[_ngcontent-%COMP%]{margin-right:2rem}.multiselect-custom[_ngcontent-%COMP%]{width:100%!important}.padding[_ngcontent-%COMP%]{padding:1%}']})}return o})(),yt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#i=this.\u0275inj=t.cJS({imports:[g.Bz.forChild([{path:"",component:X,canActivate:[V.a],data:{permissions:["dashboard.venta"]}},{path:"sale-detail",component:At,canActivate:[V.a],data:{permissions:["dashboard.venta"]}}]),g.Bz]})}return o})();var St=s(2169);let Pt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#i=this.\u0275inj=t.cJS({providers:[{provide:T.TP,useClass:k.n,multi:!0},m],imports:[v.ez,yt,x.U$,q.O,a.u5,Z.hJ,S.T,D.EV,U.V,w.Xt,P.j,E.A,u.kW,A.cc,_.L$,f.S,N.ii.forRoot(),a.UX,M.ef,c.U,h.dp,Y.q4,St.o,B.W]})}return o})()},2169:(R,I,s)=>{s.d(I,{o:()=>M});var v=s(6814),a=s(4946),x=s(5219),q=s(8468);let M=(()=>{class c{static \u0275fac=function(t){return new(t||c)};static \u0275mod=a.oAB({type:c});static \u0275inj=a.cJS({imports:[v.ez,q.x,x.m8,x.m8]})}return c})()},6263:(R,I,s)=>{s.d(I,{V:()=>P,W:()=>E});var v=s(6814),a=s(4946),x=s(5219);function q(u,A){if(1&u&&a._UZ(0,"span",5),2&u){const _=a.oxw(2);a.Q6J("ngClass",_.icon)}}function Z(u,A){if(1&u&&(a.ynx(0),a.YNc(1,q,1,1,"span",4),a.BQk()),2&u){const _=a.oxw();a.xp6(1),a.Q6J("ngIf",_.icon)}}function S(u,A){}function D(u,A){1&u&&a.YNc(0,S,0,0,"ng-template")}function U(u,A){if(1&u&&(a.TgZ(0,"span",6),a.YNc(1,D,1,0,null,7),a.qZA()),2&u){const _=a.oxw();a.xp6(1),a.Q6J("ngTemplateOutlet",_.iconTemplate)}}const w=["*"];let P=(()=>{class u{style;styleClass;severity;value;icon;rounded;templates;iconTemplate;ngAfterContentInit(){this.templates?.forEach(_=>{"icon"===_.getType()&&(this.iconTemplate=_.template)})}containerClass(){return{"p-tag p-component":!0,"p-tag-info":"info"===this.severity,"p-tag-success":"success"===this.severity,"p-tag-warning":"warning"===this.severity,"p-tag-danger":"danger"===this.severity,"p-tag-rounded":this.rounded}}static \u0275fac=function(f){return new(f||u)};static \u0275cmp=a.Xpm({type:u,selectors:[["p-tag"]],contentQueries:function(f,T,k){if(1&f&&a.Suo(k,x.jx,4),2&f){let N;a.iGM(N=a.CRH())&&(T.templates=N)}},hostAttrs:[1,"p-element"],inputs:{style:"style",styleClass:"styleClass",severity:"severity",value:"value",icon:"icon",rounded:"rounded"},ngContentSelectors:w,decls:6,vars:7,consts:[[3,"ngClass","ngStyle"],[4,"ngIf"],["class","p-tag-icon",4,"ngIf"],[1,"p-tag-value"],["class","p-tag-icon",3,"ngClass",4,"ngIf"],[1,"p-tag-icon",3,"ngClass"],[1,"p-tag-icon"],[4,"ngTemplateOutlet"]],template:function(f,T){1&f&&(a.F$t(),a.TgZ(0,"span",0),a.Hsn(1),a.YNc(2,Z,2,1,"ng-container",1),a.YNc(3,U,2,1,"span",2),a.TgZ(4,"span",3),a._uU(5),a.qZA()()),2&f&&(a.Tol(T.styleClass),a.Q6J("ngClass",T.containerClass())("ngStyle",T.style),a.xp6(2),a.Q6J("ngIf",!T.iconTemplate),a.xp6(1),a.Q6J("ngIf",T.iconTemplate),a.xp6(2),a.Oqu(T.value))},dependencies:[v.mk,v.O5,v.tP,v.PC],styles:[".p-tag{display:inline-flex;align-items:center;justify-content:center}.p-tag-icon,.p-tag-value,.p-tag-icon.pi{line-height:1.5}.p-tag.p-tag-rounded{border-radius:10rem}\n"],encapsulation:2,changeDetection:0})}return u})(),E=(()=>{class u{static \u0275fac=function(f){return new(f||u)};static \u0275mod=a.oAB({type:u});static \u0275inj=a.cJS({imports:[v.ez,x.m8,x.m8]})}return u})()}}]);