"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[423],{6423:(G,m,n)=>{n.r(m),n.d(m,{ConfigHotelModule:()=>ot});var p=n(177),h=n(3386),s=n(4341),d=n(1141),L=n(563),S=n(9998),A=n(1830),D=n(4714),U=n(2242),j=n(1305),_=n(9883),M=n(494),x=n(981),H=n(1570),$=n(4058),F=n(6554),k=n(6627),y=n(6296),E=n(4945),P=n(3887),N=n(3091),Y=n(8032),R=n.n(Y),t=n(540),T=n(1626),V=n(306);let b=(()=>{class o{constructor(e){this.httpClient=e,this.baseUrl=V.T.url,this.endpointListar="/configuracionesListar",this.endpointCreate="/configuraciones",this.endpointUpdate="/configuraciones/",this.endpointDelete="/configuraciones/"}createHttpOptions(){let e=JSON.parse(localStorage.getItem("currentUser")).token;return{headers:new T.Lr({"Content-Type":"application/json",Authorization:`Bearer ${e}`})}}getAllConfigurations(){return this.httpClient.post(`${this.baseUrl}${this.endpointListar}`,{},this.createHttpOptions())}createConfig(e){return this.httpClient.post(`${this.baseUrl}${this.endpointCreate}`,e,this.createHttpOptions())}updateConfig(e,r){return this.httpClient.post(`${this.baseUrl}${this.endpointUpdate}${e}`,r,this.createHttpOptions())}deleteConfig(e){return this.httpClient.delete(`${this.baseUrl}${this.endpointDelete}${e}`,this.createHttpOptions())}static{this.\u0275fac=function(r){return new(r||o)(t.KVO(T.Qq))}}static{this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function K(o,f){1&o&&(t.j41(0,"div",26),t.EFF(1,"El campo es requerido"),t.k0s())}function J(o,f){1&o&&(t.j41(0,"div",26),t.EFF(1,"M\xe1ximo 100 caracteres"),t.k0s())}function B(o,f){1&o&&(t.j41(0,"div",26),t.EFF(1,"El campo es requerido"),t.k0s())}function W(o,f){1&o&&(t.j41(0,"div",26),t.EFF(1,"M\xe1ximo 100 caracteres"),t.k0s())}function X(o,f){1&o&&(t.j41(0,"div",26),t.EFF(1,"El campo es requerido"),t.k0s())}function Z(o,f){1&o&&(t.j41(0,"div",26),t.EFF(1,"El campo es requerido"),t.k0s())}function z(o,f){1&o&&(t.j41(0,"div",26),t.EFF(1,"El campo es requerido"),t.k0s())}function Q(o,f){1&o&&(t.j41(0,"div",26),t.EFF(1,"El campo es requerido"),t.k0s())}function w(o,f){1&o&&(t.j41(0,"div",26),t.EFF(1,"El campo es requerido"),t.k0s())}let C=(()=>{class o{constructor(e,r,a){this.FB=e,this.spinner=r,this.configHotelService=a,this.configIds={}}ngOnInit(){this.buildForms(),this.loadConfigurations()}buildForms(){this.configFormTRA=this.FB.group({TOKEN_TARGETA_REGISTRO_ALOJAMIENTO:["",s.k0.maxLength(100)],REGISTRO_NACIONAL_DE_TURISMO:["",s.k0.maxLength(100)]}),this.configFormFactura=this.FB.group({URL_ENVIAR_FACTURAS:["",[s.k0.required,s.k0.maxLength(255)]],FACTURAS_USER_NAME:["",[s.k0.required,s.k0.maxLength(50)]],FACTURAS_USER_PASSWORD:["",[s.k0.required,s.k0.maxLength(50)]],FACTURAS_RESOLUCION:["",[s.k0.required,s.k0.maxLength(50)]],FACTURAS_FOLIO:["",[s.k0.required,s.k0.maxLength(50)]]})}loadConfigurations(){this.spinner.show(),this.configHotelService.getAllConfigurations().subscribe(e=>{this.spinner.hide(),e.forEach(r=>{r.codigo_configuracion in this.configFormTRA.controls?(this.configFormTRA.patchValue({[r.codigo_configuracion]:r.valor}),this.configIds[r.codigo_configuracion]=r.id):r.codigo_configuracion in this.configFormFactura.controls&&(this.configFormFactura.patchValue({[r.codigo_configuracion]:r.valor}),this.configIds[r.codigo_configuracion]=r.id)})},e=>{this.spinner.hide(),console.error("Error al cargar configuraciones:",e)})}isTRAFormValid(){return this.configFormTRA.get("TOKEN_TARGETA_REGISTRO_ALOJAMIENTO")?.value.trim()||this.configFormTRA.get("REGISTRO_NACIONAL_DE_TURISMO")?.value.trim()}onSaveTRA(){const e=this.configFormTRA.value,r=Object.keys(e).filter(i=>e[i]?.trim()).map(i=>({codigo_configuracion:i,valor:e[i]})),a=Object.keys(this.configIds).filter(i=>i in this.configFormTRA.controls&&!e[i]?.trim()&&null!==this.configIds[i]).map(i=>this.configIds[i]),u=[...r.map(i=>this.configIds[i.codigo_configuracion]?this.configHotelService.updateConfig(this.configIds[i.codigo_configuracion],i):this.configHotelService.createConfig(i)),...a.map(i=>this.configHotelService.deleteConfig(i))];u.length>0&&(this.spinner.show(),Promise.all(u.map(i=>i.toPromise())).then(i=>{this.spinner.hide(),R().fire("\xc9xito","Configuraci\xf3n TRA actualizada correctamente","success"),i.forEach((c,l)=>{c?.id&&(this.configIds[r[l].codigo_configuracion]=c.id)}),a.forEach(c=>{const l=Object.keys(this.configIds).find(I=>this.configIds[I]===c);l&&(this.configIds[l]=null)})},i=>{this.spinner.hide(),R().fire("Error","Hubo un problema al guardar la configuraci\xf3n TRA","error")}))}onSaveFactura(){const e=this.configFormFactura.value,r=Object.keys(e).filter(i=>e[i]?.trim()).map(i=>({codigo_configuracion:i,valor:e[i]})),a=Object.keys(this.configIds).filter(i=>i in this.configFormFactura.controls&&!e[i]?.trim()&&null!==this.configIds[i]).map(i=>this.configIds[i]),u=[...r.map(i=>this.configIds[i.codigo_configuracion]?this.configHotelService.updateConfig(this.configIds[i.codigo_configuracion],i):this.configHotelService.createConfig(i)),...a.map(i=>this.configHotelService.deleteConfig(i))];u.length>0&&(this.spinner.show(),Promise.all(u.map(i=>i.toPromise())).then(i=>{this.spinner.hide(),R().fire("\xc9xito","Configuraci\xf3n de Facturaci\xf3n guardada correctamente","success"),i.forEach((c,l)=>{c?.id&&(this.configIds[r[l].codigo_configuracion]=c.id)}),a.forEach(c=>{const l=Object.keys(this.configIds).find(I=>this.configIds[I]===c);l&&(this.configIds[l]=null)})},i=>{this.spinner.hide(),R().fire("Error","Hubo un problema al guardar la configuraci\xf3n de Facturaci\xf3n","error")}))}static{this.\u0275fac=function(r){return new(r||o)(t.rXU(s.ok),t.rXU(F.ex),t.rXU(b))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-config-hotel"]],decls:56,vars:14,consts:[["type","ball-scale-multiple",3,"fullScreen"],[1,"card","m-1"],["orientation","left"],["header","Configuraci\xf3n TRA",1,"line-height-3","m-0"],[1,"surface-section","px-2","pt-3","md:px-6","lg:px-8"],[1,"flex","align-items-center","justify-content-between","font-medium","text-3xl","text-900"],["label","Guardar",3,"disabled","click"],[1,"mt-3",3,"formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12"],["for","TOKEN_TARGETA_REGISTRO_ALOJAMIENTO"],["id","TOKEN_TARGETA_REGISTRO_ALOJAMIENTO","formControlName","TOKEN_TARGETA_REGISTRO_ALOJAMIENTO","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["style","color: red;",4,"ngIf"],["for","REGISTRO_NACIONAL_DE_TURISMO"],["id","REGISTRO_NACIONAL_DE_TURISMO","formControlName","REGISTRO_NACIONAL_DE_TURISMO","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["header","Configuraci\xf3n Facturaci\xf3n Electr\xf3nica",1,"line-height-3","m-0"],["for","URL_ENVIAR_FACTURAS"],["id","URL_ENVIAR_FACTURAS","formControlName","URL_ENVIAR_FACTURAS","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["for","FACTURAS_USER_NAME"],["id","FACTURAS_USER_NAME","formControlName","FACTURAS_USER_NAME","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["for","FACTURAS_USER_PASSWORD"],["id","FACTURAS_USER_PASSWORD","formControlName","FACTURAS_USER_PASSWORD","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["for","FACTURAS_RESOLUCION"],["id","FACTURAS_RESOLUCION","formControlName","FACTURAS_RESOLUCION","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["for","FACTURAS_FOLIO"],["id","FACTURAS_FOLIO","formControlName","FACTURAS_FOLIO","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],[2,"color","red"]],template:function(r,a){1&r&&(t.nrm(0,"ngx-spinner",0),t.j41(1,"div",1)(2,"p-tabView",2)(3,"p-tabPanel",3)(4,"div",4)(5,"div",5)(6,"span"),t.EFF(7,"Configuraci\xf3n de Tarjeta de Registro de Alojamiento"),t.k0s(),t.j41(8,"p-button",6),t.bIt("click",function(){return a.onSaveTRA()}),t.k0s()(),t.j41(9,"form",7)(10,"div",8)(11,"div",9)(12,"label",10),t.EFF(13,"Tarjeta de Registro de Alojamiento"),t.k0s(),t.nrm(14,"input",11),t.DNE(15,K,2,0,"div",12),t.DNE(16,J,2,0,"div",12),t.k0s(),t.j41(17,"div",9)(18,"label",13),t.EFF(19,"Registro Nacional de Turismo"),t.k0s(),t.nrm(20,"input",14),t.DNE(21,B,2,0,"div",12),t.DNE(22,W,2,0,"div",12),t.k0s()()()()(),t.j41(23,"p-tabPanel",15)(24,"div",4)(25,"div",5)(26,"span"),t.EFF(27,"Configuraci\xf3n de facturaci\xf3n electr\xf3nica"),t.k0s(),t.j41(28,"p-button",6),t.bIt("click",function(){return a.onSaveFactura()}),t.k0s()(),t.j41(29,"form",7)(30,"div",8)(31,"div",9)(32,"label",16),t.EFF(33,"URL Enviar Facturas"),t.k0s(),t.nrm(34,"input",17),t.DNE(35,X,2,0,"div",12),t.k0s(),t.j41(36,"div",9)(37,"label",18),t.EFF(38,"Nombre de Usuario"),t.k0s(),t.nrm(39,"input",19),t.DNE(40,Z,2,0,"div",12),t.k0s(),t.j41(41,"div",9)(42,"label",20),t.EFF(43,"Contrase\xf1a de Usuario"),t.k0s(),t.nrm(44,"input",21),t.DNE(45,z,2,0,"div",12),t.k0s(),t.j41(46,"div",9)(47,"label",22),t.EFF(48,"Resoluci\xf3n"),t.k0s(),t.nrm(49,"input",23),t.DNE(50,Q,2,0,"div",12),t.k0s(),t.j41(51,"div",9)(52,"label",24),t.EFF(53,"Folio"),t.k0s(),t.nrm(54,"input",25),t.DNE(55,w,2,0,"div",12),t.k0s()()()()()()()),2&r&&(t.Y8G("fullScreen",!0),t.R7$(8),t.Y8G("disabled",!a.isTRAFormValid()),t.R7$(1),t.Y8G("formGroup",a.configFormTRA),t.R7$(6),t.Y8G("ngIf",a.configFormTRA.get("TOKEN_TARGETA_REGISTRO_ALOJAMIENTO").hasError("required")&&a.configFormTRA.get("TOKEN_TARGETA_REGISTRO_ALOJAMIENTO").touched),t.R7$(1),t.Y8G("ngIf",a.configFormTRA.get("TOKEN_TARGETA_REGISTRO_ALOJAMIENTO").hasError("maxlength")),t.R7$(5),t.Y8G("ngIf",a.configFormTRA.get("REGISTRO_NACIONAL_DE_TURISMO").hasError("required")&&a.configFormTRA.get("REGISTRO_NACIONAL_DE_TURISMO").touched),t.R7$(1),t.Y8G("ngIf",a.configFormTRA.get("REGISTRO_NACIONAL_DE_TURISMO").hasError("maxlength")),t.R7$(6),t.Y8G("disabled",!a.configFormFactura.valid),t.R7$(1),t.Y8G("formGroup",a.configFormFactura),t.R7$(6),t.Y8G("ngIf",a.configFormFactura.get("URL_ENVIAR_FACTURAS").hasError("required")&&a.configFormFactura.get("URL_ENVIAR_FACTURAS").touched),t.R7$(5),t.Y8G("ngIf",a.configFormFactura.get("FACTURAS_USER_NAME").hasError("required")&&a.configFormFactura.get("FACTURAS_USER_NAME").touched),t.R7$(5),t.Y8G("ngIf",a.configFormFactura.get("FACTURAS_USER_PASSWORD").hasError("required")&&a.configFormFactura.get("FACTURAS_USER_PASSWORD").touched),t.R7$(5),t.Y8G("ngIf",a.configFormFactura.get("FACTURAS_RESOLUCION").hasError("required")&&a.configFormFactura.get("FACTURAS_RESOLUCION").touched),t.R7$(5),t.Y8G("ngIf",a.configFormFactura.get("FACTURAS_FOLIO").hasError("required")&&a.configFormFactura.get("FACTURAS_FOLIO").touched))},dependencies:[p.bT,s.qT,s.me,s.BC,s.cb,d.$n,U.S,s.j4,s.JD,F.et,E.JQ,E.Kp]})}}return o})();var O=n(1765);const q=[{path:"",component:C,canActivate:[O.q],data:{permissions:["administracion.hotelconfiguracion"]}},{path:"crear",component:C,canActivate:[O.q],data:{permissions:["administracion.hotelconfiguracion.crear"]}},{path:":id/edit",component:C,canActivate:[O.q],data:{permissions:["administracion.hotelconfiguracion"]}}];let tt=(()=>{class o{static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[N.iI.forChild(q),N.iI]})}}return o})();var it=n(635);let ot=(()=>{class o{static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({providers:[{provide:T.a7,useClass:it.R,multi:!0},b],imports:[p.MD,tt,h.bG,s.YN,d.tm,L.Z,S.MB,A.m,D.wZ,U.u,j.f,_.kr,M.Ko,x.O3,H.P,$.RZ.forRoot(),s.X1,F.PO,k.I,y.iV,E.fd,P.G]})}}return o})()},3887:(G,m,n)=>{n.d(m,{G:()=>s});var p=n(177),h=n(540);let s=(()=>{class d{static{this.\u0275fac=function(A){return new(A||d)}}static{this.\u0275mod=h.$C({type:d})}static{this.\u0275inj=h.G2t({imports:[p.MD]})}}return d})()}}]);