"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[159],{159:(ce,x,o)=>{o.r(x),o.d(x,{UsersModule:()=>oe});var k=o(177),n=o(4341),p=o(3091),F=o(467),c=o(5779),E=o(1626),w=o(8032),d=o.n(w),h=o(5989),e=o(540),f=o(6554),g=o(9998),b=o(1570),v=o(5589),G=o(1550),C=o(3386),m=o(1141),_=o(8436),N=o(7693),U=o(563),y=o(2242),I=o(9883);function B(r,u){if(1&r){const t=e.RV6();e.j41(0,"button",35),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openNew())}),e.k0s()}}function $(r,u){if(1&r){const t=e.RV6();e.j41(0,"div",36),e.nrm(1,"span"),e.j41(2,"span",37)(3,"form",38)(4,"div",39)(5,"input",40),e.bIt("keyup.enter",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.buscarPorTecla(i))})("input",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.searchInput())}),e.k0s(),e.j41(6,"button",41),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.search())}),e.k0s()()()()()}if(2&r){const t=e.XpG();e.R7$(3),e.Y8G("formGroup",t.formSearch)}}function P(r,u){1&r&&(e.j41(0,"tr")(1,"th"),e.EFF(2,"Usuario"),e.k0s(),e.j41(3,"th"),e.EFF(4,"Correo"),e.k0s(),e.j41(5,"th"),e.EFF(6,"Estado"),e.k0s(),e.j41(7,"th"),e.EFF(8,"Rol"),e.k0s(),e.j41(9,"th"),e.EFF(10,"Acciones"),e.k0s()())}function M(r,u){if(1&r){const t=e.RV6();e.j41(0,"p-button",46),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,a=e.XpG();return e.Njj(a.getAUser(i.id))}),e.k0s()}}function A(r,u){if(1&r&&e.nrm(0,"p-button",47),2&r){const t=e.XpG().$implicit;e.Y8G("routerLink","usersHotel/"+t.id)}}function X(r,u){if(1&r){const t=e.RV6();e.j41(0,"p-button",48),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,a=e.XpG();return e.Njj(a.confirmDelete(i.id))}),e.k0s()}}function D(r,u){if(1&r&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td",42),e.DNE(10,M,1,0,"p-button",43),e.DNE(11,A,1,1,"p-button",44),e.DNE(12,X,1,0,"p-button",45),e.nrm(13,"p-confirmDialog"),e.k0s()()),2&r){const t=u.$implicit,s=e.XpG();e.R7$(2),e.JRh(t.usuario),e.R7$(2),e.JRh(t.email),e.R7$(2),e.JRh(1==t.estado?"Activo":"Inactivo"),e.R7$(2),e.JRh(s.getRolName(t.rol_id)),e.R7$(2),e.Y8G("ngIf",s.permisoActualizar),e.R7$(1),e.Y8G("ngIf",s.permisoAsignarHotel),e.R7$(1),e.Y8G("ngIf",s.permisoEliminar)}}function Y(r,u){if(1&r&&e.nrm(0,"input",49),2&r){const t=e.XpG();e.Y8G("value",t.userData.id)}}function H(r,u){if(1&r&&e.nrm(0,"input",50),2&r){const t=e.XpG();e.FS9("placeholder",t.userData.usuario)}}function J(r,u){if(1&r&&e.nrm(0,"input",51),2&r){const t=e.XpG();e.FS9("placeholder",t.userData.email)}}const V=function(){return{"min-width":"50rem"}},L=function(){return["nombre","medida","precio","cantidad","inventario","acciones"]},R=function(){return{width:"95vw"}};let z=(()=>{class r{constructor(t,s,i,a,l,ne,ae,le,ue,de,pe){this.confirmationService=t,this.spinner=s,this.toastModule=i,this.dialogModule=a,this.messageService=l,this.usersService=ne,this.breadcrumbService=ae,this.tableModule=le,this.buttonModule=ue,this.rolesService=de,this.layoutService=pe,this.permisoCrear=h.u.hasPermission(["administracion.usuario.crear"]),this.permisoActualizar=h.u.hasPermission(["administracion.usuario.actualizar"]),this.permisoEliminar=h.u.hasPermission(["administracion.usuario.eliminar"]),this.permisoAsignarHotel=h.u.hasPermission(["administracion.usuario.asignarHotel"]),this.visible=!1,this.visibleModalEditar=!1,this.selectedState=null,this.selectedUserIndex=-1,this.pageCount=10,this.pageActual=1,this.ultimaPage=1,this.disablePageLeft=!1,this.disablePageRight=!1,this.loadingTable=!1,this.first=0,this.rows=8,this.opciones=[{nombre:"Si",value:1},{nombre:"No",value:0}],this.formSearch=new n.gE({search:new n.MJ("",[])}),this.formNuser=new n.gE({usuario:new n.MJ("",n.k0.required),email:new n.MJ("",[n.k0.required,n.k0.email]),rol_id:new n.MJ("",n.k0.required),superadmin:new n.MJ("",n.k0.required),password:new n.MJ("",n.k0.required)}),this.formEuser=new n.gE({usuario:new n.MJ("",n.k0.required),email:new n.MJ("",[n.k0.required,n.k0.email]),rol_id:new n.MJ("",n.k0.required),superadmin:new n.MJ("",n.k0.required),id:new n.MJ("",[])})}ngOnInit(){this.getIndex(),this.usersService.data.subscribe(t=>{this.users=t}),this.breadcrumbService.currentBreadcrumbs.subscribe(t=>this.breadcrumbs=t),this.rolesService.getRoles(999,"",1).subscribe(t=>{this.roles=t.data})}onQuitItem(t){this.breadcrumbService.quitItem(t)}getIndex(t="",s=this.pageCount,i=1){this.spinner.show(),this.loadingTable=!0,this.usersService.getAll(s,t,i).subscribe(a=>{this.loadingTable=!1,this.users=a.data,this.ultimaPage=a.last_page,this.totalUsers=a.total,this.ultimaPage=a.last_page,a.total>s&&(this.disablePageRight=!0),this.validatePage(),this.spinner.hide()},a=>{console.log("Error: ",a)})}getAUser(t){this.usersService.getById(t).subscribe(s=>{this.userData=s,this.userData.id=t,this.formEuser.patchValue({usuario:this.userData.usuario,email:this.userData.email,rol_id:this.userData.rol_id,superadmin:this.userData.superadmin}),this.visibleModalEditar=!0})}getRolName(t){return 1===t?"Super Administrador":2===t?"Administrador":3===t?"Gestor":"Rol no identificado"}openNew(){this.visible=!0,this.formNuser.reset()}newUser(){var t=this;return(0,F.A)(function*(){t.usersService.insertData(t.formNuser.value).subscribe(i=>{"success"==i.code&&(d().fire({title:"\xc9xito",text:"El usuario ha sido creado exitosamente.",icon:"success",timer:2e3,showConfirmButton:!1}),t.visible=!1,t.usersService.refreshUsersData())},i=>{if(422===i.status){t.visible=!1;let a="";for(const l in i.error)i.error.hasOwnProperty(l)&&""==a&&(a+=`${l}: ${i.error[l]}\n`);d().fire({title:"Error de validaci\xf3n",text:a,icon:"warning",timer:2e3,showConfirmButton:!1})}else d().fire("Error","Ha ocurrido un error desconocido.","error")})})()}updateUser(){this.formEuser.get("id").setValue(this.userData.id);const t=this.formEuser.value;this.usersService.updateUser(t).subscribe(s=>{this.visibleModalEditar=!1;let i=JSON.parse(localStorage.getItem("currentUser"));i.usuario.id==t.id&&(i.usuario={...i.usuario,email:t.email,rol_id:t.rol_id,usuario:t.usuario},localStorage.setItem("currentUser",JSON.stringify({usuario:i.usuario,version:i.version,token:i.token})),this.layoutService.reloadComponent()),d().fire({title:"\xc9xito",text:"El usuario ha sido actualizado exitosamente.",icon:"success",timer:2e3,showConfirmButton:!1}),this.usersService.refreshUsersData()},s=>{console.log("Error:",s)})}deleteUser(t){const s={headers:new E.Lr({"Content-Type":"application/x-www-form-urlencoded"}),body:`id=${t}`};this.usersService.deleteUser(s).subscribe(i=>{this.usersService.refreshUsersData()},i=>{console.log("Error:",i)})}confirmDelete(t){d().fire({title:"\xbfEstas Seguro que deseas eliminar el usuario?",text:"Ten cuidado esta acci\xf3n no se prodr\xe1 reversar",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xed, Confirmar",cancelButtonText:"Cancelar"}).then(s=>{s.isConfirmed&&(this.deleteUser(t),d().fire({title:"\xc9xito",text:"El usuario ha sido eliminado.",icon:"success",timer:2e3,showConfirmButton:!1}))})}searchInput(){let t=this.formSearch.get("search").value;this.pageActual=1,""==t&&this.getIndex(t)}search(){let t=this.formSearch.get("search").value;this.getIndex(t)}onPage(t){this.pageCount=t.rows,this.getIndex("",this.pageCount)}onPageChange(t){this.first=t.first,this.rows=t.rows}leftTable(){this.pageActual=this.pageActual-1,this.getIndex("",this.pageCount,this.pageActual),this.validatePage()}rightTable(){this.pageActual=this.pageActual+1,this.getIndex("",this.pageCount,this.pageActual),this.validatePage()}validatePage(){1==this.pageActual&&(this.disablePageLeft=!1),this.pageActual>1&&(this.disablePageLeft=!0),this.ultimaPage==this.pageActual&&(this.disablePageRight=!1),this.ultimaPage>this.pageActual&&(this.disablePageRight=!0)}buscarPorTecla(t){"Enter"==t.code&&this.search()}static{this.\u0275fac=function(s){return new(s||r)(e.rXU(c.td),e.rXU(f.ex),e.rXU(g.MB),e.rXU(b.P),e.rXU(c.bg),e.rXU(v.g),e.rXU(G.b),e.rXU(C.bG),e.rXU(m.tm),e.rXU(_.P),e.rXU(N.Y))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["ng-component"]],features:[e.Jv_([c.td,c.bg])],decls:70,vars:39,consts:[[1,"surface-section","px-4","py-5","md:px-6","lg:px-8"],[1,"flex","align-items-start","flex-column","lg:justify-content-between","lg:flex-row"],[1,"font-medium","text-3xl","text-900"],[1,"mt-3","lg:mt-0"],["pButton","","pRipple","","label","Crear","class","p-button-outlined mr-2",3,"click",4,"ngIf"],[1,"grid","mt-3"],[1,"col-12"],[1,"card","px-3","py-3"],["responsiveLayout","scroll","selectionMode","multiple","dataKey","usuario",3,"value","tableStyle","loading","rows","globalFilterFields","rowHover","onPage"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[2,"text-align","center"],[1,"p-buttonset"],["pButton","","pRipple","","label","","icon","pi pi-arrow-left",3,"disabled","click"],["pButton","","pRipple","",3,"label"],["pButton","","pRipple","","label","","icon","pi pi-arrow-right",3,"disabled","click"],["header","Nuevo Usuario",3,"visible","modal","draggable","resizable","visibleChange"],[3,"formGroup","ngSubmit"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12","md:col-6"],["type","text","placeholder","Usuario","pInputText","","formControlName","usuario",1,"w-full","mb-3","border-round-3xl"],["id","email1","type","email","placeholder","Correo electr\xf3nico","pInputText","","formControlName","email",1,"w-full","mb-3","border-round-3xl"],[1,"field","col-12","md:col-3"],["htmlFor","state"],["optionLabel","nombre","formControlName","rol_id","optionValue","id","placeholder","Seleccione una opci\xf3n",3,"options","virtualScrollItemSize"],["optionLabel","nombre","formControlName","superadmin","optionValue","value","placeholder","Seleccione una opci\xf3n",3,"options"],["id","password","type","password","placeholder","Contrase\xf1a","pInputText","","formControlName","password",1,"w-full","mb-3","border-round-3xl"],[1,"field","col-12","md:col-12"],["pButton","","pRipple","","label","Crear Usuario","icon","pi pi-user","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl",3,"disabled"],["id","editU","header","Editar Usuario",3,"visible","modal","draggable","resizable","visibleChange","onVisibleChange"],["type","text","hidden","hidden","pInputText","","class","w-full mb-3 border-round-3xl","formControlName","id",3,"value",4,"ngIf"],["type","text","pInputText","","class","w-full mb-3 border-round-3xl","formControlName","usuario",3,"placeholder",4,"ngIf"],["id","email1","type","email","pInputText","","class","w-full mb-3 border-round-3xl","formControlName","email",3,"placeholder",4,"ngIf"],["pButton","","pRipple","","label","Editar Usuario","icon","pi pi-pencil","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl",3,"disabled"],["pButton","","pRipple","","label","Crear",1,"p-button-outlined","mr-2",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[3,"formGroup"],[1,"p-inputgroup"],["formControlName","search","pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto",3,"keyup.enter","input"],["type","button","pButton","","pRipple","",1,"pi","pi-search",3,"click"],[1,"flex","gap-2"],["icon","pi pi-pencil","severity","info",3,"click",4,"ngIf"],["icon","pi pi-cog","severity","warning",3,"routerLink",4,"ngIf"],["icon","pi pi-trash","severity","danger",3,"click",4,"ngIf"],["icon","pi pi-pencil","severity","info",3,"click"],["icon","pi pi-cog","severity","warning",3,"routerLink"],["icon","pi pi-trash","severity","danger",3,"click"],["type","text","hidden","hidden","pInputText","","formControlName","id",1,"w-full","mb-3","border-round-3xl",3,"value"],["type","text","pInputText","","formControlName","usuario",1,"w-full","mb-3","border-round-3xl",3,"placeholder"],["id","email1","type","email","pInputText","","formControlName","email",1,"w-full","mb-3","border-round-3xl",3,"placeholder"]],template:function(s,i){1&s&&(e.nrm(0,"p-toast"),e.j41(1,"div",0)(2,"div",1)(3,"div")(4,"div",2),e.EFF(5,"Usuarios"),e.k0s()(),e.j41(6,"div",3),e.DNE(7,B,1,0,"button",4),e.k0s()()(),e.j41(8,"div",5)(9,"div",6)(10,"div",7)(11,"p-table",8),e.bIt("onPage",function(l){return i.onPage(l)}),e.DNE(12,$,7,1,"ng-template",9),e.DNE(13,P,11,0,"ng-template",10),e.DNE(14,D,14,7,"ng-template",11),e.k0s(),e.nrm(15,"br"),e.j41(16,"div",12)(17,"span",13)(18,"button",14),e.bIt("click",function(){return i.leftTable()}),e.k0s(),e.nrm(19,"button",15),e.j41(20,"button",16),e.bIt("click",function(){return i.rightTable()}),e.k0s()()()()()(),e.j41(21,"p-dialog",17),e.bIt("visibleChange",function(l){return i.visible=l}),e.j41(22,"div",6)(23,"form",18),e.bIt("ngSubmit",function(){return i.newUser()}),e.j41(24,"div",19)(25,"div",20)(26,"label"),e.EFF(27,"Usuario"),e.k0s(),e.nrm(28,"input",21),e.k0s(),e.j41(29,"div",20)(30,"label"),e.EFF(31,"Email"),e.k0s(),e.nrm(32,"input",22),e.k0s(),e.j41(33,"div",23)(34,"label",24),e.EFF(35,"Rol"),e.k0s(),e.nrm(36,"p-dropdown",25),e.k0s(),e.j41(37,"div",23)(38,"label",24),e.EFF(39,"Super Admin"),e.k0s(),e.nrm(40,"p-dropdown",26),e.k0s(),e.j41(41,"div",20)(42,"label"),e.EFF(43,"Contrase\xf1a"),e.k0s(),e.nrm(44,"input",27),e.k0s(),e.j41(45,"div",28),e.nrm(46,"button",29),e.k0s()()()()(),e.j41(47,"p-dialog",30),e.bIt("visibleChange",function(l){return i.visibleModalEditar=l})("onVisibleChange",function(){return i.visibleModalEditar=!i.visibleModalEditar}),e.j41(48,"form",18),e.bIt("ngSubmit",function(){return i.updateUser()}),e.j41(49,"div",19)(50,"div",28),e.DNE(51,Y,1,1,"input",31),e.k0s(),e.j41(52,"div",20)(53,"label"),e.EFF(54,"Usuario"),e.k0s(),e.DNE(55,H,1,1,"input",32),e.k0s(),e.j41(56,"div",20)(57,"label"),e.EFF(58,"Email"),e.k0s(),e.DNE(59,J,1,1,"input",33),e.k0s(),e.j41(60,"div",20)(61,"label",24),e.EFF(62,"Rol"),e.k0s(),e.nrm(63,"p-dropdown",25),e.k0s(),e.j41(64,"div",20)(65,"label",24),e.EFF(66,"Super Admin"),e.k0s(),e.nrm(67,"p-dropdown",26),e.k0s(),e.j41(68,"div",28),e.nrm(69,"button",34),e.k0s()()()()),2&s&&(e.R7$(7),e.Y8G("ngIf",i.permisoCrear),e.R7$(4),e.Y8G("value",i.users)("tableStyle",e.lJ4(35,V))("loading",i.loadingTable)("rows",8)("globalFilterFields",e.lJ4(36,L))("rowHover",!0),e.R7$(7),e.Y8G("disabled",!i.disablePageLeft),e.R7$(1),e.Y8G("label",i.pageActual),e.R7$(1),e.Y8G("disabled",!i.disablePageRight),e.R7$(1),e.Aen(e.lJ4(37,R)),e.Y8G("visible",i.visible)("modal",!0)("draggable",!1)("resizable",!1),e.R7$(2),e.Y8G("formGroup",i.formNuser),e.R7$(13),e.Y8G("options",i.roles)("virtualScrollItemSize",38),e.R7$(4),e.Y8G("options",i.opciones),e.R7$(6),e.Y8G("disabled",i.formNuser.invalid),e.R7$(1),e.Aen(e.lJ4(38,R)),e.Y8G("visible",i.visibleModalEditar)("modal",!0)("draggable",!1)("resizable",!1),e.R7$(1),e.Y8G("formGroup",i.formEuser),e.R7$(3),e.Y8G("ngIf",i.visibleModalEditar),e.R7$(4),e.Y8G("ngIf",i.visibleModalEditar),e.R7$(4),e.Y8G("ngIf",i.visibleModalEditar),e.R7$(4),e.Y8G("options",i.roles)("virtualScrollItemSize",38),e.R7$(4),e.Y8G("options",i.opciones),e.R7$(2),e.Y8G("disabled",i.formEuser.invalid))},dependencies:[k.bT,p.Wk,C.XI,c.Ei,m._f,m.$n,n.qT,n.me,n.BC,n.cb,U.n,g.y8,y.S,I.ms,b.l,n.j4,n.JD],encapsulation:2})}}return r})();var j=o(1765),S=o(3192),T=o(7697);let O=(()=>{class r{constructor(t,s,i,a){this.hotelService=t,this.usersService=s,this.route=i,this.spinner=a,this.loading=!0}ngOnInit(){this.spinner.show(),this.route.params.subscribe(t=>{this.id=t.id}),this.getHotels(),this.getHotelsByUser(this.id)}getHotels(){this.hotelService.getAll(9999,"",1).subscribe(t=>{this.hoteles=t.data.map(i=>({key:i.id,label:i.nombre}))})}getHotelsByUser(t){this.usersService.getHotelsByUser(t).subscribe(s=>{this.hotelesSeleccionados=s.hoteles.map(a=>({key:a.hotel_id})),this.loading=!1,this.spinner.hide()})}saveHotelsByUser(){let t=this.hotelesSeleccionados.map(s=>s.key);this.usersService.saveHotelsByUser(this.id,t).subscribe(s=>{this.loading=!0,"success"==s.code?(d().fire({title:"Hoteles guardados correctamente",icon:"success",timer:2e3,showConfirmButton:!1}),this.getHotelsByUser(this.id)):d().fire({title:"Error al guardar los hoteles",icon:"error",timer:2e3})})}static{this.\u0275fac=function(s){return new(s||r)(e.rXU(S.p),e.rXU(v.g),e.rXU(p.nX),e.rXU(f.ex))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-users-hotel"]],decls:12,vars:5,consts:[["type","ball-scale-multiple","size","large","bdColor","rgba(192,192,192,0.8)","template","<img src='assets/loading/cargando.gif' />"],[1,"card","mb-3"],[1,"surface-section","py-1","md:px-6","lg:px-8"],[1,"flex","align-items-start","flex-column","lg:justify-content-between","lg:flex-column"],[1,"flex"],["pButton","","pRipple","","label","","icon","pi pi-arrow-left",1,"p-button-outlined","mr-4",3,"routerLink"],[1,"flex","align-items-center","font-medium","text-3xl","text-900"],[1,"card"],["filterPlaceholder","Escriba para buscar...","filterMode","lenient","selectionMode","checkbox",1,"w-full","md:w-30rem",3,"value","filter","selection","loading","selectionChange"],[1,"flex","justify-content-end","mt-3"],["pButton","","type","button","label","Guardar","severity","success",1,"border-round-3xl","bg-admin","boder-admin","mt-3","w-full",3,"click"]],template:function(s,i){1&s&&(e.nrm(0,"ngx-spinner",0),e.j41(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e.nrm(5,"button",5),e.j41(6,"div",6),e.EFF(7," Hoteles del usuario "),e.k0s()()()()(),e.j41(8,"div",7)(9,"p-tree",8),e.bIt("selectionChange",function(l){return i.hotelesSeleccionados=l}),e.k0s(),e.j41(10,"div",9)(11,"button",10),e.bIt("click",function(){return i.saveHotelsByUser()}),e.k0s()()()),2&s&&(e.R7$(5),e.Y8G("routerLink","/dashboard/admin/users"),e.R7$(4),e.Y8G("value",i.hoteles)("filter",!0)("selection",i.hotelesSeleccionados)("loading",i.loading))},dependencies:[p.Wk,m._f,U.n,T.PH,f.et],encapsulation:2})}}return r})(),Z=(()=>{class r{static{this.\u0275fac=function(s){return new(s||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[p.iI.forChild([{path:"",component:z,canActivate:[j.q],data:{permissions:["administracion.usuario"]}},{path:"usersHotel/:id",component:O,canActivate:[j.q],data:{permissions:["administracion.usuario.asignarHotel"]}}]),p.iI]})}}return r})();var K=o(5493),W=o(1830),Q=o(4714),q=o(1305),ee=o(494),te=o(981),ie=o(635),se=o(4058),re=o(9715);let oe=(()=>{class r{static{this.\u0275fac=function(s){return new(s||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({providers:[{provide:E.a7,useClass:ie.R,multi:!0},v.g,S.p],imports:[k.MD,Z,C.bG,K.e,n.YN,m.tm,U.Z,g.MB,W.m,Q.wZ,y.u,q.f,I.kr,ee.Ko,te.O3,b.P,se.RZ.forRoot(),n.X1,re.RolesModule,T.ft,f.PO]})}}return r})()}}]);