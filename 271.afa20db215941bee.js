"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[271],{1271:(ie,q,d)=>{d.r(q),d.d(q,{ProductsModule:()=>ee});var h=d(6814),l=d(95),P=d(9664),E=d(6068),b=d(707),C=d(4480),S=d(4104),Q=d(6340),V=d(6022),T=d(3714),U=d(6218),Z=d(2160),k=d(1865),M=d(354),x=d(7213),w=d(9862),Y=d(8712),R=d(5722),f=d(86),B=d(3519),c=d.n(B),_=d(2791),t=d(4946),F=d(5619),G=d(4444);let A=(()=>{class r{constructor(e){this.httpClient=e,this.dataSubject=new F.X([]),this.endpointListar="/productoListar",this.endpointProductGet="/productoEditar/",this.endpointProductCreate="/productoCrear",this.endpointProductUpdate="/productoActualizar",this.endpointEliminar="/productoEliminar",this.endpointProductImpuesto="/productoImpuestoGet",this.endpointProductImpuestoCrear="/productoImpuestoCrear",this.endpointGetProductImpuesto="/getProductoImpuesto",this.endpointProductoDetalleMostrar="/productoDetalleMostrar",this.endpointProductoDetalleCrear="/productoDetalleCrear",this.endpointEliminarDetalle="/productoDetalleEliminar",this.data=this.dataSubject.asObservable(),this.baseUrl=G.D.url}getAll(e,o="",i=1){return this.httpClient.post(`${this.baseUrl+this.endpointListar}?per_page=${e}&page=${i}&search=${o}`,{})}getProducto(e){return this.httpClient.get(`${this.baseUrl+this.endpointProductGet+e}`)}refreshUsersData(){this.getAll(30).subscribe(e=>{this.dataSubject.next(e.data)},e=>{console.log("Error: ",e)})}createProduct(e){return this.httpClient.post(`${this.baseUrl+this.endpointProductCreate}`,e)}eliminarProduct(e){return this.httpClient.post(`${this.baseUrl+this.endpointEliminar}`,e)}updateProducto(e){return this.httpClient.post(`${this.baseUrl+this.endpointProductUpdate}`,e)}getImpuesto(e,o=10,i=1,a=""){return this.httpClient.get(`${this.baseUrl+this.endpointProductImpuesto}/${e}?per_page=${o}&page=${i}${a?`&search=${a}`:""}`)}createImpuesto(e){return this.httpClient.post(`${this.baseUrl+this.endpointProductImpuestoCrear}`,e)}getImpuestoCrear(){return this.httpClient.get(`${this.baseUrl+this.endpointGetProductImpuesto}`)}getDetallesProducto(e,o=10,i=1,a=""){return this.httpClient.get(`${this.baseUrl+this.endpointProductoDetalleMostrar}/${e}?per_page=${o}&page=${i}${a?`&search=${a}`:""}`)}createDetalle(e){return this.httpClient.post(`${this.baseUrl+this.endpointProductoDetalleCrear}`,e)}deleteDetalle(e){return this.httpClient.post(`${this.baseUrl+this.endpointEliminarDetalle}`,e)}static#t=this.\u0275fac=function(o){return new(o||r)(t.LFG(w.eN))};static#e=this.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var v=d(8672),D=d(5219);const L=["fileUpload"],$=["fileUploadCreate"];function H(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"button",40),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.openModal())}),t.qZA()}}function j(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"div",41),t._UZ(1,"span"),t.TgZ(2,"span",42)(3,"form",43)(4,"div",44)(5,"input",45),t.NdJ("keyup.enter",function(i){t.CHM(e);const a=t.oxw();return t.KtG(a.buscarPorTecla(i))})("input",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.searchInput())}),t.qZA(),t.TgZ(6,"button",46),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.search())}),t.qZA()()()()()}if(2&r){const e=t.oxw();t.xp6(3),t.Q6J("formGroup",e.formSearch)}}function K(r,s){1&r&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"Nombre"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Medida"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Precio"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Tipo"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Inventario"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Visible venta"),t.qZA(),t.TgZ(13,"th"),t._uU(14,"Visible recetas"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Acciones"),t.qZA()())}function O(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"p-button",51),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,a=t.oxw();return t.KtG(a.editProduct(i.id))}),t.qZA()}}function z(r,s){if(1&r&&t._UZ(0,"p-button",53),2&r){const e=t.oxw(2).$implicit;t.Q6J("routerLink",e.id+"/impuesto")}}function X(r,s){if(1&r&&(t.TgZ(0,"div"),t.YNc(1,z,1,1,"p-button",52),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf","1"==e.tipo_producto)}}function W(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"p-button",54),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,a=t.oxw();return t.KtG(a.confirmDelete(i.id))}),t.qZA()}}function tt(r,s){if(1&r&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.ALo(8,"number"),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td",47),t.YNc(18,O,1,0,"p-button",48),t.YNc(19,X,2,1,"div",49),t.YNc(20,W,1,0,"p-button",50),t.qZA()()),2&r){const e=s.$implicit,o=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,10,e.nombre)),t.xp6(3),t.Oqu(e.medida.nombre),t.xp6(2),t.Oqu(t.lcZ(8,12,e.precio)),t.xp6(3),t.Oqu("1"==e.tipo_producto?"Producto":"Servicio"),t.xp6(2),t.Oqu(e.inventario.nombre),t.xp6(2),t.Oqu(e.visible_venta?"Si":"No"),t.xp6(2),t.Oqu(e.visible_receta?"Si":"No"),t.xp6(2),t.Q6J("ngIf",o.permisoActualizar),t.xp6(1),t.Q6J("ngIf",o.permisoDetalle||o.permisoImpuesto),t.xp6(1),t.Q6J("ngIf",o.permisoEliminar)}}function et(r,s){1&r&&(t.TgZ(0,"tr")(1,"td",55),t._uU(2,"Cargando informacion porfavor espere ..."),t.qZA()())}function it(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function ot(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function rt(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function at(r,s){if(1&r&&(t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Medida"),t.qZA(),t._UZ(3,"p-dropdown",57),t.YNc(4,rt,2,0,"div",26),t.qZA()),2&r){const e=t.oxw();t.xp6(3),t.Q6J("options",e.medida),t.xp6(1),t.Q6J("ngIf",e.formCreateProduct.get("medida_id").hasError("required"))}}function nt(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function st(r,s){if(1&r&&(t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Cantidad"),t.qZA(),t._UZ(3,"input",58),t.YNc(4,nt,2,0,"div",26),t.qZA()),2&r){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",e.formCreateProduct.get("cantidad").hasError("required"))}}function lt(r,s){if(1&r&&(t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Cantidad Limitada"),t.qZA(),t._UZ(3,"p-dropdown",59),t.qZA()),2&r){const e=t.oxw();t.xp6(3),t.Q6J("options",e.limiteCantidad)}}function dt(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function ut(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function ct(r,s){1&r&&(t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Stock m\xednimo"),t.qZA(),t._UZ(3,"input",60),t.qZA())}function pt(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function mt(r,s){if(1&r&&(t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Precio base"),t.qZA(),t._UZ(3,"input",61),t.YNc(4,pt,2,0,"div",26),t.qZA()),2&r){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",e.formCreateProduct.get("precio_base").hasError("required"))}}function _t(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function gt(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function ht(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Visible receta"),t.qZA(),t.TgZ(3,"p-dropdown",62),t.NdJ("onChange",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onVisibleRecetaChange())}),t.qZA(),t.YNc(4,gt,2,0,"div",26),t.qZA()}if(2&r){const e=t.oxw();t.xp6(3),t.Q6J("options",e.visibleReceta),t.xp6(1),t.Q6J("ngIf",e.formCreateProduct.get("visible_receta").hasError("required"))}}function ft(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function bt(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function vt(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function Pt(r,s){if(1&r&&(t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Medida"),t.qZA(),t._UZ(3,"p-dropdown",57),t.YNc(4,vt,2,0,"div",26),t.qZA()),2&r){const e=t.oxw();t.xp6(3),t.Q6J("options",e.medida),t.xp6(1),t.Q6J("ngIf",e.formEditProduct.get("medida_id").hasError("required"))}}function Ct(r,s){if(1&r&&(t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Cantidad limitada"),t.qZA(),t._UZ(3,"p-dropdown",59),t.qZA()),2&r){const e=t.oxw();t.xp6(3),t.Q6J("options",e.limiteCantidad)}}function Tt(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function Zt(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function xt(r,s){1&r&&(t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Stock m\xednimo"),t.qZA(),t._UZ(3,"input",60),t.qZA())}function At(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function It(r,s){if(1&r&&(t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Precio base"),t.qZA(),t._UZ(3,"input",61),t.YNc(4,At,2,0,"div",26),t.qZA()),2&r){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",e.formEditProduct.get("precio_base").hasError("required"))}}function qt(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function Et(r,s){1&r&&(t.TgZ(0,"div",56),t._uU(1,"Campo requerido"),t.qZA())}function Ut(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"div",24)(1,"label"),t._uU(2,"Visible receta"),t.qZA(),t.TgZ(3,"p-dropdown",62),t.NdJ("onChange",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onVisibleRecetaChangeEdit())}),t.qZA(),t.YNc(4,Et,2,0,"div",26),t.qZA()}if(2&r){const e=t.oxw();t.xp6(3),t.Q6J("options",e.visibleReceta),t.xp6(1),t.Q6J("ngIf",e.formCreateProduct.get("visible_receta").hasError("required"))}}const wt=function(){return{"min-width":"50rem"}},Dt=function(){return["nombre","medida","precio","cantidad","inventario","acciones"]},J=function(){return{width:"60vw"}};let Jt=(()=>{class r{ngOnInit(){this.buildForm(),this.getIndex(),this.visibleModalProducto=!1}constructor(e,o,i){this.productsService=e,this.FB=o,this.spinner=i,this.permisoCrear=_.e.hasPermission(["gestionInventario.productos.crear"]),this.permisoActualizar=_.e.hasPermission(["gestionInventario.productos.actualizar"]),this.permisoEliminar=_.e.hasPermission(["gestionInventario.productos.eliminar"]),this.permisoDetalle=_.e.hasPermission(["gestionInventario.productos.detalle"]),this.permisoImpuesto=_.e.hasPermission(["gestionInventario.productos.impuestoProducto"]),this.visibleModalProducto=!0,this.ventaVisible=!1,this.pageCount=10,this.imagen=null,this.loadingTable=!1,this.visibleModalProductoEditar=!1,this.idEditando=0,this.first=0,this.rows=8,this.data=Array(18).fill(0),this.pageActual=1,this.ultimaPage=1,this.disablePageLeft=!1,this.disablePageRight=!1,this.registrosContar=0,this.visibleServicio=!0,this.visibleServicioEditar=!0}openModal(){this.onCreate()}getIndex(e="",o=this.pageCount,i=1){this.spinner.show(),this.loadingTable=!0,this.productsService.getAll(o,e,i).subscribe(a=>{this.loadingTable=!1,this.productsData=a.data,this.ultimaPage=a.last_page,this.registrosContar=a.total,this.ultimaPage=a.last_page,a.total>o&&(this.disablePageRight=!0),this.validatePage(),this.spinner.hide()},a=>{console.log("Error: ",a)})}newProduct(){this.spinner.show();let e=this.formCreateProduct.value;e.inventario_id=e.inventario_id.id,e.visible_venta=e.visible_venta.id,e.tipo_producto=e.tipo_producto.id,e.visible_receta=e.visible_receta?e?.visible_receta.id:0,e.estado=1,2!=e.tipo_producto?(e.medida_id=e.medida_id.id,e.limite_cantidad=e.limite_cantidad.id):(e.cantidad=0,e.limite_cantidad=0,e.medida_id=0,e.precio_base=0,e.stop_minimo=0);const o=new FormData;for(const i in e)e.hasOwnProperty(i)&&o.append(i,e[i]);if(null!=this.imagen){const i=new Blob([this.imagen],{type:"image/png"}),a=new File([i],"nombre_archivo.png",{type:"image/png"});o.append("imagen",a)}this.productsService.createProduct(o).subscribe(i=>{this.spinner.hide(),this.imagen=null,this.visibleModalProducto=!1,"success"==i.code?(this.formCreateProduct.reset(),c().fire({title:"Exito",text:"Producto creado exitosamente.",icon:"success"}),this.getIndex()):c().fire({title:"Error",text:"Error al crear el producto.",icon:"error"})},i=>{console.log("Error: ",i)})}buildForm(){this.formSearch=this.FB.group({search:["",[]]}),this.formCreateProduct=this.FB.group({nombre:["",[l.kI.required]],medida_id:["",[l.kI.required]],descripcion:["",[]],precio:["",[l.kI.required,l.kI.min(1)]],cantidad:["",[l.kI.required,l.kI.pattern("^[0-9]*$"),l.kI.min(0)]],inventario_id:["",[l.kI.required]],visible_venta:["",[l.kI.required]],visible_receta:["",[l.kI.required]],precio_base:["",[l.kI.required,l.kI.min(0)]],limite_cantidad:["",[l.kI.required]],stop_minimo:["",[]],tipo_producto:["",[l.kI.required]]}),this.formEditProduct=this.FB.group({nombre:["",[l.kI.required]],medida_id:["",[l.kI.required]],descripcion:["",[]],precio:["",[l.kI.required,l.kI.min(1)]],cantidad:["",[l.kI.required,l.kI.pattern("^[0-9]*$"),l.kI.min(0)]],inventario_id:["",[l.kI.required]],visible_venta:["",[l.kI.required]],visible_receta:["",[l.kI.required]],precio_base:["",[l.kI.required,l.kI.min(0)]],limite_cantidad:["",[l.kI.required]],stop_minimo:["",[]],tipo_producto:["",[l.kI.required]]})}searchInput(){let e=this.formSearch.get("search").value;this.pageActual=1,""==e&&this.getIndex(e)}search(){let e=this.formSearch.get("search").value;this.getIndex(e)}onPage(e){this.pageCount=e.rows,this.getIndex("",this.pageCount)}onCreate(){this.fileUploadCreate.clear(),this.imagen=null,this.formCreateProduct.reset(),this.productsService.getProducto(0).subscribe(e=>{this.medida=e.medida,this.inventario=e.inventario,this.visibleVenta=e.visible_venta,this.visibleReceta=e.visible_receta,this.limiteCantidad=e.sin_limite,this.tipo=e.tipo,this.visibleModalProducto=!0,this.registrosContar=e.total,this.onChangeTipoProductoCrear()},e=>{console.log("Error: ",e)})}editProduct(e){this.imagen=null,this.fileUpload.clear(),this.idEditando=e,this.spinner.show(),this.productsService.getProducto(e).subscribe(o=>{this.spinner.hide(),this.medida=o.medida,this.inventario=o.inventario,this.visibleVenta=o.visible_venta,this.visibleReceta=o.visible_receta,this.limiteCantidad=o.sin_limite,this.tipo=o.tipo,this.dataEditarInfoProductos=o.producto;let i=null,a=null,n=null,m=null,p=null,g=null;this.medida.forEach(u=>{u.id==this.dataEditarInfoProductos.medida_id&&(i=u)}),this.inventario.forEach(u=>{u.id==this.dataEditarInfoProductos.inventario_id&&(a=u)}),this.limiteCantidad.forEach(u=>{u.id==this.dataEditarInfoProductos.sin_limite_cantidad&&(n=u)}),this.tipo.forEach(u=>{u.id==this.dataEditarInfoProductos.tipo_producto&&(m=u)}),this.visibleVenta.forEach(u=>{u.id==this.dataEditarInfoProductos.visible_venta&&(p=u)}),this.visibleReceta.forEach(u=>{u.id==this.dataEditarInfoProductos.visible_receta&&(g=u)}),setTimeout(()=>{this.onChangeTipoProductoEditarIncio(m),this.formEditProduct.get("nombre").setValue(this.dataEditarInfoProductos.nombre),this.formEditProduct.get("medida_id").setValue(i),this.formEditProduct.get("descripcion").setValue(this.dataEditarInfoProductos.descripcion),this.formEditProduct.get("precio").setValue(this.dataEditarInfoProductos.precio),this.formEditProduct.get("cantidad").setValue(this.dataEditarInfoProductos.cantidad),this.formEditProduct.get("inventario_id").setValue(a),this.formEditProduct.get("visible_venta").setValue(p),this.formEditProduct.get("limite_cantidad").setValue(n),this.formEditProduct.get("stop_minimo").setValue(this.dataEditarInfoProductos.stop_minimo),this.formEditProduct.get("tipo_producto").setValue(m),this.formEditProduct.get("precio_base").setValue(this.dataEditarInfoProductos.precio_base),this.formEditProduct.get("visible_receta").setValue(g),this.visibleModalProductoEditar=!0,this.cargarImagen(o.imagen)},1)},o=>{console.log("Error: ",o)})}cargarImagen(e){const o=atob(e),i=new Array(o.length);for(let p=0;p<o.length;p++)i[p]=o.charCodeAt(p);const a=new Uint8Array(i),n=new Blob([a],{type:"image/jpeg"}),m=new File([n],"nombre_archivo.jpg",{type:"image/jpeg"});this.fileUpload.clear(),this.fileUpload.files=[m]}submitCreate(){this.formCreateProduct.valid?this.newProduct():this.formCreateProduct.markAllAsTouched()}onSelect(e){this.imagen=e.currentFiles[0]}blobToBase64(e){return new Promise((o,i)=>{const a=new FileReader;a.onloadend=()=>{a.result&&"string"==typeof a.result?o(a.result):i(new Error("Error al convertir Blob a Base64"))},a.onerror=()=>{i(new Error("Error al leer el Blob"))},a.readAsDataURL(e)})}confirmDelete(e){c().fire({title:"\xbfEstas Seguro que deseas eliminar el producto?",text:"Ten cuidado esta acci\xf3n no se prodr\xe1 reversar",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xed, Confirmar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&(this.spinner.show(),this.productsService.eliminarProduct({id:e}).subscribe(i=>{this.spinner.hide(),"success"==i.code?(c().fire({title:"Exito",text:"Producto eliminado exitosamente.",icon:"success"}),this.getIndex()):c().fire({title:"Error",text:"Error al eliminar el producto.",icon:"error"})},i=>{console.log("Error: ",i)}))})}onRemove(e){this.imagen=null}updateProducto(e=!1){this.spinner.show();let o=this.formEditProduct.value;"object"==typeof o.inventario_id&&(o.inventario_id=o.inventario_id.id),"object"==typeof o.visible_venta&&(o.visible_venta=o.visible_venta.id),"object"==typeof o.tipo_producto&&(o.tipo_producto=o.tipo_producto.id),"object"==typeof o.visible_receta&&(o.visible_receta=o?.visible_receta.id),o.id=this.idEditando,o.estado=1,o.confirm=e,2!=o.tipo_producto?("object"==typeof o.medida_id&&(o.medida_id=o.medida_id.id),"object"==typeof o.limite_cantidad&&(o.limite_cantidad=o.limite_cantidad.id)):(o.cantidad=0,o.limite_cantidad=0,o.medida_id=0,o.precio_base=0,o.stop_minimo=0);const i=new FormData;for(const a in o)o.hasOwnProperty(a)&&i.append(a,o[a]);if(null!=this.imagen){const a=new Blob([this.imagen],{type:"image/png"}),n=new File([a],"nombre_archivo.png",{type:"image/png"});i.append("imagen",n)}this.productsService.updateProducto(i).subscribe(a=>{this.spinner.hide(),this.imagen=null,this.visibleModalProductoEditar=!1,"success"==a.code?(c().fire({title:"Exito",text:"Producto editado exitosamente.",icon:"success"}),this.getIndex()):c().fire({title:"Error",text:"Error al editar el producto.",icon:"error"})},a=>{if(this.spinner.hide(),this.visibleModalProductoEditar=!1,"error"==a.error.code){const n=a.error.registros,m=this.productsData.findIndex(u=>u.id==n[0].producto_id),p=this.productsData[m];let g=n.map(u=>u.nombre_receta).join(", ");c().fire({title:"Error al actualizar",html:`\n                        <p style="margin: 0;">Para cambiar la visibilidad de \xe9ste producto </p>\n                        <p>debes eliminarlo de las siguientes recetas:</p>\n                        <p style="color: orangered"> ${g} </p>\n                        <p>\xbfQuieres eliminar el producto <span style="color: orangered;">${p.nombre}</span> de estas recetas?</p>\n                        `,icon:"warning",showConfirmButton:!0,confirmButtonText:"Eliminar",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(u=>{u.isConfirmed?this.updateProducto(!0):this.imagen=null})}})}submitUpdate(){this.formEditProduct.valid&&this.updateProducto()}onPageChange(e){this.first=e.first,this.rows=e.rows}leftTable(){this.pageActual=this.pageActual-1,this.getIndex("",this.pageCount,this.pageActual),this.validatePage()}rightTable(){this.pageActual=this.pageActual+1,this.getIndex("",this.pageCount,this.pageActual),this.validatePage()}validatePage(){1==this.pageActual&&(this.disablePageLeft=!1),this.pageActual>1&&(this.disablePageLeft=!0),this.ultimaPage==this.pageActual&&(this.disablePageRight=!1),this.ultimaPage>this.pageActual&&(this.disablePageRight=!0)}onChangeTipoProductoCrear(){let e=this.formCreateProduct.get("tipo_producto").value;1==e?.id&&(this.visibleServicio=!0,this.formCreateProduct.get("medida_id").enable(),this.formCreateProduct.get("cantidad").enable(),this.formCreateProduct.get("limite_cantidad").enable(),this.formCreateProduct.get("stop_minimo").enable(),this.formCreateProduct.get("precio_base").enable(),this.formCreateProduct.get("visible_receta").enable(),this.formCreateProduct.get("cantidad").setValue(null),this.formCreateProduct.get("medida_id").setValue(null),this.formCreateProduct.get("limite_cantidad").setValue(null),this.formCreateProduct.get("stop_minimo").setValue(null),this.formCreateProduct.get("precio_base").setValue(null),this.formCreateProduct.get("visible_receta").setValue(null)),2==e?.id&&(this.visibleServicio=!1,this.formCreateProduct.get("medida_id").disable(),this.formCreateProduct.get("cantidad").disable(),this.formCreateProduct.get("limite_cantidad").disable(),this.formCreateProduct.get("stop_minimo").disable(),this.formCreateProduct.get("precio_base").disable(),this.formCreateProduct.get("visible_receta").disable(),this.formCreateProduct.get("cantidad").setValue(0),this.formCreateProduct.get("medida_id").setValue(0),this.formCreateProduct.get("limite_cantidad").setValue(0),this.formCreateProduct.get("stop_minimo").setValue(0),this.formCreateProduct.get("precio_base").setValue(0),this.formCreateProduct.get("visible_receta").setValue(0)),setTimeout(()=>{if(1==this.formCreateProduct.get("visible_venta").value.id){let i=null;this.visibleVenta.forEach(a=>{0==a.id&&(i=a)}),this.formCreateProduct.get("visible_receta").setValue(i)}},100)}onChangeTipoProductoEditar(){let e=this.formEditProduct.get("tipo_producto").value;1==e?.id&&(this.visibleServicioEditar=!0,this.formEditProduct.get("medida_id").enable(),this.formEditProduct.get("cantidad").enable(),this.formEditProduct.get("limite_cantidad").enable(),this.formEditProduct.get("stop_minimo").enable(),this.formEditProduct.get("precio_base").enable(),this.formEditProduct.get("cantidad").setValue(this.editarData.cantidad),this.formEditProduct.get("medida_id").setValue(this.editarData.medida_id),this.formEditProduct.get("limite_cantidad").setValue(this.editarData.limite_cantidad),this.formEditProduct.get("stop_minimo").setValue(this.editarData.stop_minimo),this.formEditProduct.get("precio_base").setValue(this.editarData.precio_base)),2==e?.id&&(this.editarData=this.formEditProduct.value,this.visibleServicioEditar=!1,this.formEditProduct.get("cantidad").disable(),this.formEditProduct.get("limite_cantidad").disable(),this.formEditProduct.get("stop_minimo").disable(),this.formEditProduct.get("precio_base").disable(),this.formEditProduct.get("cantidad").setValue(0),this.formEditProduct.get("medida_id").setValue(0),this.formEditProduct.get("limite_cantidad").setValue(0),this.formEditProduct.get("stop_minimo").setValue(0),this.formEditProduct.get("precio_base").setValue(0))}onChangeTipoProductoEditarIncio(e){1==e.id&&(this.visibleServicioEditar=!0,this.formEditProduct.get("medida_id").enable(),this.formEditProduct.get("cantidad").enable(),this.formEditProduct.get("limite_cantidad").enable(),this.formEditProduct.get("stop_minimo").enable(),this.formEditProduct.get("precio_base").enable()),2==e.id&&(this.editarData=this.formEditProduct.value,this.visibleServicioEditar=!1,this.formEditProduct.get("cantidad").disable(),this.formEditProduct.get("limite_cantidad").disable(),this.formEditProduct.get("stop_minimo").disable(),this.formEditProduct.get("precio_base").disable(),this.formEditProduct.get("cantidad").setValue(0),this.formEditProduct.get("medida_id").setValue(0),this.formEditProduct.get("limite_cantidad").setValue(0),this.formEditProduct.get("stop_minimo").setValue(0),this.formEditProduct.get("precio_base").setValue(0))}onVisibleVentaChange(){if(1==this.formCreateProduct.get("visible_venta").value.id){let o=null;this.visibleVenta.forEach(i=>{0==i.id&&(o=i)}),this.formCreateProduct.get("visible_receta").setValue(o)}}onVisibleRecetaChange(){if(1==this.formCreateProduct.get("visible_receta").value.id){let o=null;this.visibleVenta.forEach(i=>{0==i.id&&(o=i)}),this.formCreateProduct.get("visible_venta").setValue(o)}}onVisibleVentaChangeEdit(){if(1==this.formEditProduct.get("visible_venta").value.id){let o=null;this.visibleVenta.forEach(i=>{0==i.id&&(o=i)}),this.formEditProduct.get("visible_receta").setValue(o)}}onVisibleRecetaChangeEdit(){if(1==this.formEditProduct.get("visible_receta").value.id){let o=null;this.visibleVenta.forEach(i=>{0==i.id&&(o=i)}),this.formEditProduct.get("visible_venta").setValue(o)}}buscarPorTecla(e){"Enter"==e.code&&this.search()}static#t=this.\u0275fac=function(o){return new(o||r)(t.Y36(A),t.Y36(l.qu),t.Y36(v.t2))};static#e=this.\u0275cmp=t.Xpm({type:r,selectors:[["app-products"]],viewQuery:function(o,i){if(1&o&&(t.Gf(L,5),t.Gf($,5)),2&o){let a;t.iGM(a=t.CRH())&&(i.fileUpload=a.first),t.iGM(a=t.CRH())&&(i.fileUploadCreate=a.first)}},decls:113,vars:61,consts:[["type","ball-scale-multiple"],[1,"surface-section","px-4","py-5","md:px-6","lg:px-8"],[1,"flex","align-items-start","flex-column","lg:justify-content-between","lg:flex-row"],[1,"font-medium","text-3xl","text-900"],[1,"flex","align-items-center","text-700","flex-wrap"],[1,"mr-5","flex","align-items-center","mt-3"],[1,"mt-3","lg:mt-0"],["pButton","","pRipple","","label","Crear","class","p-button-outlined mr-2","icon","",3,"click",4,"ngIf"],[1,"grid","mt-3"],[1,"col-12"],[1,"card","px-3","py-3"],["responsiveLayout","scroll","selectionMode","multiple","dataKey","usuario",3,"value","tableStyle","loading","rows","globalFilterFields","rowHover","onPage"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","loadingbody"],[2,"text-align","center"],[1,"p-buttonset"],["pButton","","pRipple","","label","","icon","pi pi-arrow-left",3,"disabled","click"],["pButton","","pRipple","",3,"label"],["pButton","","pRipple","","label","","icon","pi pi-arrow-right",3,"disabled","click"],["header","Nuevo Producto",3,"visible","modal","draggable","resizable","visibleChange"],[3,"formGroup","ngSubmit"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12","md:col-6"],["type","text","pInputText","","formControlName","nombre",1,"w-full","mb-3","border-round-3xl"],["style","color: red;",4,"ngIf"],["formControlName","tipo_producto","optionLabel","nombre",3,"options","onChange"],["class","field col-12 md:col-6",4,"ngIf"],["formControlName","inventario_id","optionLabel","nombre",3,"options"],["type","number","min","1","pInputText","","formControlName","precio",1,"w-full","mb-3","border-round-3xl"],["formControlName","visible_venta","optionLabel","nombre",3,"options","onChange"],[1,"field","col-12","md:col-12"],["name","imsgenes[]","chooseLabel","Seleccionar","cancelLabel","Cancelar","accept","image/*",3,"showUploadButton","maxFileSize","onRemove","onClear","onSelect"],["fileUploadCreate",""],["formControlName","descripcion","pInputTextarea","","rows","3","cols","20"],["pButton","","pRipple","","label","Crear Producto","icon","pi pi-fw","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl",3,"disabled"],["header","Editar Producto",3,"visible","modal","draggable","resizable","visibleChange"],["fileUpload",""],["pButton","","pRipple","","label","Editar Producto","icon","pi pi-fw pi-star","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl",3,"disabled"],["pButton","","pRipple","","label","Crear","icon","",1,"p-button-outlined","mr-2",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[3,"formGroup"],[1,"p-inputgroup"],["formControlName","search","pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto",3,"keyup.enter","input"],["type","button","pButton","","pRipple","",1,"pi","pi-search",3,"click"],[1,"flex","gap-2"],["icon","pi pi-pencil","severity","info",3,"click",4,"ngIf"],[4,"ngIf"],["icon","pi pi-trash","severity","danger",3,"click",4,"ngIf"],["icon","pi pi-pencil","severity","info",3,"click"],["icon","pi pi-cog","severity","danger",3,"routerLink",4,"ngIf"],["icon","pi pi-cog","severity","danger",3,"routerLink"],["icon","pi pi-trash","severity","danger",3,"click"],["colspan","8"],[2,"color","red"],["optionLabel","nombre","formControlName","medida_id",3,"options"],["type","number","min","0","formControlName","cantidad","pInputText","",1,"w-full","mb-3","border-round-3xl"],["formControlName","limite_cantidad","optionLabel","nombre",3,"options"],["type","number","min","0","pInputText","","formControlName","stop_minimo",1,"w-full","mb-3","border-round-3xl"],["type","number","min","0","pInputText","","formControlName","precio_base",1,"w-full","mb-3","border-round-3xl"],["formControlName","visible_receta","optionLabel","nombre",3,"options","onChange"]],template:function(o,i){1&o&&(t._UZ(0,"ngx-spinner",0),t.TgZ(1,"div",1)(2,"div",2)(3,"div")(4,"div",3),t._uU(5,"Productos / Servicios"),t.qZA(),t.TgZ(6,"div",4),t._UZ(7,"div",5),t.qZA()(),t.TgZ(8,"div",6),t.YNc(9,H,1,0,"button",7),t.qZA()()(),t.TgZ(10,"div",8)(11,"div",9)(12,"div",10)(13,"p-table",11),t.NdJ("onPage",function(n){return i.onPage(n)}),t.YNc(14,j,7,1,"ng-template",12),t.YNc(15,K,17,0,"ng-template",13),t.YNc(16,tt,21,14,"ng-template",14),t.YNc(17,et,3,0,"ng-template",15),t.qZA(),t._UZ(18,"br"),t.TgZ(19,"div",16)(20,"span",17)(21,"button",18),t.NdJ("click",function(){return i.leftTable()}),t.qZA(),t._UZ(22,"button",19),t.TgZ(23,"button",20),t.NdJ("click",function(){return i.rightTable()}),t.qZA()()()()()(),t.TgZ(24,"p-dialog",21),t.NdJ("visibleChange",function(n){return i.visibleModalProducto=n}),t.TgZ(25,"div",9)(26,"form",22),t.NdJ("ngSubmit",function(){return i.submitCreate()}),t.TgZ(27,"div",23)(28,"div",24)(29,"label"),t._uU(30,"Nombre"),t.qZA(),t._UZ(31,"input",25),t.YNc(32,it,2,0,"div",26),t.qZA(),t.TgZ(33,"div",24)(34,"label"),t._uU(35,"Tipo"),t.qZA(),t.TgZ(36,"p-dropdown",27),t.NdJ("onChange",function(){return i.onChangeTipoProductoCrear()}),t.qZA(),t.YNc(37,ot,2,0,"div",26),t.qZA(),t.YNc(38,at,5,2,"div",28),t.YNc(39,st,5,1,"div",28),t.YNc(40,lt,4,1,"div",28),t.TgZ(41,"div",24)(42,"label"),t._uU(43,"Inventario"),t.qZA(),t._UZ(44,"p-dropdown",29),t.YNc(45,dt,2,0,"div",26),t.qZA(),t.TgZ(46,"div",24)(47,"label"),t._uU(48,"Precio"),t.qZA(),t._UZ(49,"input",30),t.YNc(50,ut,2,0,"div",26),t.qZA(),t.YNc(51,ct,4,0,"div",28),t.YNc(52,mt,5,1,"div",28),t.TgZ(53,"div",24)(54,"label"),t._uU(55,"Visible venta"),t.qZA(),t.TgZ(56,"p-dropdown",31),t.NdJ("onChange",function(){return i.onVisibleVentaChange()}),t.qZA(),t.YNc(57,_t,2,0,"div",26),t.qZA(),t.YNc(58,ht,5,2,"div",28),t.TgZ(59,"div",32)(60,"p-fileUpload",33,34),t.NdJ("onRemove",function(n){return i.onRemove(n)})("onClear",function(n){return i.onRemove(n)})("onSelect",function(n){return i.onSelect(n)}),t.qZA()(),t.TgZ(62,"div",32)(63,"label"),t._uU(64,"Descripci\xf3n"),t.qZA(),t._UZ(65,"textarea",35),t.qZA(),t.TgZ(66,"div",32),t._UZ(67,"button",36),t.qZA()(),t._UZ(68,"br"),t.qZA()()(),t.TgZ(69,"p-dialog",37),t.NdJ("visibleChange",function(n){return i.visibleModalProductoEditar=n}),t.TgZ(70,"div",9)(71,"form",22),t.NdJ("ngSubmit",function(){return i.submitUpdate()}),t.TgZ(72,"div",23)(73,"div",24)(74,"label"),t._uU(75,"Nombre"),t.qZA(),t._UZ(76,"input",25),t.YNc(77,ft,2,0,"div",26),t.qZA(),t.TgZ(78,"div",24)(79,"label"),t._uU(80,"Tipo"),t.qZA(),t.TgZ(81,"p-dropdown",27),t.NdJ("onChange",function(){return i.onChangeTipoProductoEditar()}),t.qZA(),t.YNc(82,bt,2,0,"div",26),t.qZA(),t.YNc(83,Pt,5,2,"div",28),t.YNc(84,Ct,4,1,"div",28),t.TgZ(85,"div",24)(86,"label"),t._uU(87,"Inventario"),t.qZA(),t._UZ(88,"p-dropdown",29),t.YNc(89,Tt,2,0,"div",26),t.qZA(),t.TgZ(90,"div",24)(91,"label"),t._uU(92,"Precio"),t.qZA(),t._UZ(93,"input",30),t.YNc(94,Zt,2,0,"div",26),t.qZA(),t.YNc(95,xt,4,0,"div",28),t.YNc(96,It,5,1,"div",28),t.TgZ(97,"div",24)(98,"label"),t._uU(99,"Visible venta"),t.qZA(),t.TgZ(100,"p-dropdown",31),t.NdJ("onChange",function(){return i.onVisibleVentaChangeEdit()}),t.qZA(),t.YNc(101,qt,2,0,"div",26),t.qZA(),t.YNc(102,Ut,5,2,"div",28),t.TgZ(103,"div",32)(104,"p-fileUpload",33,38),t.NdJ("onRemove",function(n){return i.onRemove(n)})("onClear",function(n){return i.onRemove(n)})("onSelect",function(n){return i.onSelect(n)}),t.qZA()(),t.TgZ(106,"div",32)(107,"label"),t._uU(108,"Descripci\xf3n"),t.qZA(),t._UZ(109,"textarea",35),t.qZA(),t.TgZ(110,"div",32),t._UZ(111,"button",39),t.qZA()(),t._UZ(112,"br"),t.qZA()()()),2&o&&(t.xp6(9),t.Q6J("ngIf",i.permisoCrear),t.xp6(4),t.Q6J("value",i.productsData)("tableStyle",t.DdM(57,wt))("loading",i.loadingTable)("rows",8)("globalFilterFields",t.DdM(58,Dt))("rowHover",!0),t.xp6(8),t.Q6J("disabled",!i.disablePageLeft),t.xp6(1),t.Q6J("label",i.pageActual),t.xp6(1),t.Q6J("disabled",!i.disablePageRight),t.xp6(1),t.Akn(t.DdM(59,J)),t.Q6J("visible",i.visibleModalProducto)("modal",!0)("draggable",!1)("resizable",!1),t.xp6(2),t.Q6J("formGroup",i.formCreateProduct),t.xp6(6),t.Q6J("ngIf",i.formCreateProduct.get("nombre").hasError("required")),t.xp6(4),t.Q6J("options",i.tipo),t.xp6(1),t.Q6J("ngIf",i.formCreateProduct.get("tipo_producto").hasError("required")),t.xp6(1),t.Q6J("ngIf",i.visibleServicio),t.xp6(1),t.Q6J("ngIf",i.visibleServicio),t.xp6(1),t.Q6J("ngIf",i.visibleServicio),t.xp6(4),t.Q6J("options",i.inventario),t.xp6(1),t.Q6J("ngIf",i.formCreateProduct.get("inventario_id").hasError("required")),t.xp6(5),t.Q6J("ngIf",i.formCreateProduct.get("precio").hasError("required")),t.xp6(1),t.Q6J("ngIf",i.visibleServicio),t.xp6(1),t.Q6J("ngIf",i.visibleServicio),t.xp6(4),t.Q6J("options",i.visibleVenta),t.xp6(1),t.Q6J("ngIf",i.formCreateProduct.get("visible_venta").hasError("required")),t.xp6(1),t.Q6J("ngIf",i.visibleServicio),t.xp6(2),t.Q6J("showUploadButton",!1)("maxFileSize",1e6),t.xp6(7),t.Q6J("disabled",i.formCreateProduct.invalid),t.xp6(2),t.Akn(t.DdM(60,J)),t.Q6J("visible",i.visibleModalProductoEditar)("modal",!0)("draggable",!1)("resizable",!1),t.xp6(2),t.Q6J("formGroup",i.formEditProduct),t.xp6(6),t.Q6J("ngIf",i.formEditProduct.get("nombre").hasError("required")),t.xp6(4),t.Q6J("options",i.tipo),t.xp6(1),t.Q6J("ngIf",i.formEditProduct.get("tipo_producto").hasError("required")),t.xp6(1),t.Q6J("ngIf",i.visibleServicioEditar),t.xp6(1),t.Q6J("ngIf",i.visibleServicioEditar),t.xp6(4),t.Q6J("options",i.inventario),t.xp6(1),t.Q6J("ngIf",i.formEditProduct.get("inventario_id").hasError("required")),t.xp6(5),t.Q6J("ngIf",i.formEditProduct.get("precio").hasError("required")),t.xp6(1),t.Q6J("ngIf",i.visibleServicioEditar),t.xp6(1),t.Q6J("ngIf",i.visibleServicioEditar),t.xp6(4),t.Q6J("options",i.visibleVenta),t.xp6(1),t.Q6J("ngIf",i.formEditProduct.get("visible_venta").hasError("required")),t.xp6(1),t.Q6J("ngIf",i.visibleServicioEditar),t.xp6(2),t.Q6J("showUploadButton",!1)("maxFileSize",1e6),t.xp6(7),t.Q6J("disabled",i.formEditProduct.invalid))},dependencies:[h.O5,f.rH,P.iA,D.jx,E.p,b.Hq,b.zx,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.qQ,C.H,T.o,U.g,Z.Lt,x.V,l.sg,l.u,v.Ro,h.JJ,h.rS],styles:["svg[_ngcontent-%COMP%]{width:45%}"]})}return r})();var I=d(4844);function Nt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"div",46),t._UZ(1,"span"),t.TgZ(2,"span",47)(3,"form",7)(4,"div",48)(5,"input",49),t.NdJ("keyup.enter",function(i){t.CHM(e);const a=t.oxw(2);return t.KtG(a.buscarPorTeclaDetalles(i))})("input",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.searchInputDetalles())}),t.qZA(),t.TgZ(6,"button",50),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.searchDetalles())}),t.qZA()()()()()}if(2&r){const e=t.oxw(2);t.xp6(3),t.Q6J("formGroup",e.formSearch)}}function yt(r,s){1&r&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"Cantidad"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Tipo de operaci\xf3n"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Estado"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Acciones"),t.qZA()())}function St(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"td",55)(1,"p-button",56),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,a=t.oxw(2);return t.KtG(a.eliminarProducto(i.id))}),t.qZA()()}}function Qt(r,s){1&r&&t._UZ(0,"td")}function Vt(r,s){1&r&&t._UZ(0,"td")}const kt=function(r){return{color:r,"font-weight":900}};function Mt(r,s){if(1&r&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td",51),t._uU(6),t.qZA(),t.YNc(7,St,2,0,"td",52),t.YNc(8,Qt,1,0,"td",53),t.YNc(9,Vt,1,0,"ng-template",null,54,t.W1O),t.qZA()),2&r){const e=s.$implicit,o=t.oxw(2);t.xp6(2),t.Oqu(e.cantidad),t.xp6(2),t.Oqu(o.tipo_operacion_name(e.tipo_operacion_id)),t.xp6(1),t.Q6J("ngStyle",t.VKq(6,kt,o.getColor(e.estado))),t.xp6(1),t.Oqu(o.operacion(e.estado)),t.xp6(1),t.Q6J("ngIf",2==e.estado&&e.id===o.ultimoIngresado.id),t.xp6(1),t.Q6J("ngIf",!(2==e.estado&&e.id===o.ultimoIngresado.id))}}function Yt(r,s){1&r&&(t.TgZ(0,"tr")(1,"td",57),t._uU(2,"Cargando informacion porfavor espere ..."),t.qZA()())}const N=function(){return{"min-width":"50rem"}};function Rt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"p-tabPanel",29)(1,"div",30)(2,"div",31)(3,"div")(4,"div",32)(5,"button",33),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.openModalAgregar())}),t.qZA(),t._uU(6," Agregar Producto "),t.qZA()()()(),t.TgZ(7,"div",34)(8,"div",20)(9,"div",35)(10,"p-table",36),t.YNc(11,Nt,7,1,"ng-template",37),t.YNc(12,yt,9,0,"ng-template",38),t.YNc(13,Mt,11,8,"ng-template",39),t.YNc(14,Yt,3,0,"ng-template",40),t.qZA(),t._UZ(15,"br"),t.TgZ(16,"div",41)(17,"span",42)(18,"button",43),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.leftTableDetalles())}),t.qZA(),t._UZ(19,"button",44),t.TgZ(20,"button",45),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.rightTableDetalles())}),t.qZA()()()()()()()}if(2&r){const e=t.oxw();t.xp6(10),t.Q6J("value",e.dataDetails)("tableStyle",t.DdM(8,N))("loading",e.loadingTable)("rows",8)("rowHover",!0),t.xp6(8),t.Q6J("disabled",!e.disablePageLeftDetalles),t.xp6(1),t.Q6J("label",e.pageActualDetalles),t.xp6(1),t.Q6J("disabled",!e.disablePageRightDetalles)}}function Bt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"div",46),t._UZ(1,"span"),t.TgZ(2,"span",47)(3,"form",7)(4,"div",48)(5,"input",49),t.NdJ("keyup.enter",function(i){t.CHM(e);const a=t.oxw(2);return t.KtG(a.buscarPorTeclaImpuestos(i))})("input",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.searchInputImpuestos())}),t.qZA(),t.TgZ(6,"button",50),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.searchImpuestos())}),t.qZA()()()()()}if(2&r){const e=t.oxw(2);t.xp6(3),t.Q6J("formGroup",e.formSearch)}}function Ft(r,s){1&r&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"Nombre"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Porcentaje"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Acciones"),t.qZA()())}function Gt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td",55)(6,"p-button",56),t.NdJ("click",function(){const a=t.CHM(e).$implicit,n=t.oxw(2);return t.KtG(n.confirmDelete(a.id))}),t.qZA()()()}if(2&r){const e=s.$implicit;t.xp6(2),t.Oqu(e.nombre),t.xp6(2),t.Oqu(e.porcentaje)}}function Lt(r,s){1&r&&(t.TgZ(0,"tr")(1,"td",57),t._uU(2,"Cargando informacion porfavor espere ..."),t.qZA()())}function $t(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"p-tabPanel",58)(1,"div",30)(2,"div",31)(3,"div")(4,"div",32)(5,"button",33),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.openModalCrear())}),t.qZA(),t._uU(6," Agregar Impuesto "),t.qZA()(),t.TgZ(7,"div",59)(8,"button",60),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.enviarImpuesto())}),t.qZA()()()(),t.TgZ(9,"div",34)(10,"div",20)(11,"div",35)(12,"p-table",61),t.YNc(13,Bt,7,1,"ng-template",37),t.YNc(14,Ft,7,0,"ng-template",38),t.YNc(15,Gt,7,2,"ng-template",39),t.YNc(16,Lt,3,0,"ng-template",40),t.qZA(),t._UZ(17,"br"),t.TgZ(18,"div",41)(19,"span",42)(20,"button",43),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.leftTableImpuestos())}),t.qZA(),t._UZ(21,"button",44),t.TgZ(22,"button",45),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.rightTableImpuestos())}),t.qZA()()()()()()()}if(2&r){const e=t.oxw();t.xp6(12),t.Q6J("value",e.impuestosData)("tableStyle",t.DdM(7,N))("loading",e.loadingTable)("rows",8),t.xp6(8),t.Q6J("disabled",!e.disablePageLeftImpuestos),t.xp6(1),t.Q6J("label",e.pageActualImpuestos),t.xp6(1),t.Q6J("disabled",!e.disablePageRightImpuestos)}}function Ht(r,s){1&r&&(t.TgZ(0,"div",62),t._uU(1,"Campo requerido"),t.qZA())}function jt(r,s){1&r&&(t.TgZ(0,"div",62),t._uU(1,"Campo requerido"),t.qZA())}const Kt=function(){return{width:"60vw"}},Ot=function(){return{width:"95vw"}};let zt=(()=>{class r{constructor(e,o,i,a,n){this.FB=e,this.productsService=o,this.spinner=i,this.route=a,this.router=n,this.permisoDetalle=_.e.hasPermission(["gestionInventario.productos.detalle"]),this.permisoImpuesto=_.e.hasPermission(["gestionInventario.productos.impuestoProducto"]),this.loadingTable=!0,this.impuestosData=[],this.impuestoModalCrear=!1,this.dataDetails=[],this.productoModalAgregar=!1,this.pageActualDetalles=1,this.pageCountDetalles=10,this.disablePageLeftDetalles=!1,this.disablePageRightDetalles=!1,this.pageActualImpuestos=1,this.pageCountImpuestos=10,this.disablePageLeftImpuestos=!1,this.disablePageRightImpuestos=!1}ngOnInit(){this.impuestosData=[],this.route.params.subscribe(e=>{this.id=e.id}),this.formCreate=this.FB.group({impuesto:["",l.kI.required]}),setTimeout(()=>{this.loadImpuesto()}),this.buildForm(),this.pageActualDetalles=1,this.getDetallesProducto(this.id,this.pageCountDetalles,this.pageActualDetalles)}buildForm(){this.formSearch=this.FB.group({search:["",[]]}),this.form=this.FB.group({nombreProducto:["",[]],precio:["",[]],cantidad:["",[]],medida:["",[]]}),this.form.get("nombreProducto").disable(),this.form.get("precio").disable(),this.form.get("cantidad").disable(),this.form.get("medida").disable(),this.formCreateDetalle=this.FB.group({cantidad:["",l.kI.required]})}getDetallesProducto(e,o=this.pageCountDetalles,i=1,a=""){this.spinner.show(),this.loadingTable=!0,this.productsService.getDetallesProducto(e,o,i,a).subscribe(n=>{this.spinner.hide(),this.loadingTable=!1,this.productsData=n.producto,this.dataDetails=n.detalles.data,this.tipo_operacion=n.tipo_operacion,this.ultimaPageDetalles=n.detalles.last_page,this.registrosContarDetalles=n.detalles.total,this.pageActualDetalles=i,this.validatePageDetalles();const m=Number(this.productsData.precio).toLocaleString("es-CO");this.form.get("nombreProducto").setValue(this.productsData.nombre.charAt(0).toUpperCase()+this.productsData.nombre.slice(1).toLowerCase()),this.form.get("precio").setValue(`$${m}`),this.form.get("cantidad").setValue(this.productsData.cantidad),n.medida.forEach(g=>{g.id==this.productsData.medida_id&&this.form.get("medida").setValue(g.nombre)}),this.ultimoIngresado=n.registro_reciente},n=>{this.spinner.hide(),this.loadingTable=!1,console.log("Error: ",n)})}searchInputDetalles(){let e=this.formSearch.get("search").value;this.pageActualDetalles=1,""==e&&this.getDetallesProducto(this.id,this.pageCountDetalles,this.pageActualDetalles,e)}searchDetalles(){let e=this.formSearch.get("search").value;this.pageActualDetalles=1,this.getDetallesProducto(this.id,this.pageCountDetalles,this.pageActualDetalles,e)}onPageDetalles(e){this.pageActualDetalles=e.page+1,this.pageCountDetalles=e.rows,this.getDetallesProducto(this.id,this.pageCountDetalles,this.pageActualDetalles,this.formSearch.get("search").value)}buscarPorTeclaDetalles(e){"Enter"==e.code&&this.searchDetalles()}leftTableDetalles(){this.pageActualDetalles--,this.getDetallesProducto(this.productsData.id,this.pageCountDetalles,this.pageActualDetalles),this.validatePageDetalles()}rightTableDetalles(){this.pageActualDetalles++,this.getDetallesProducto(this.productsData.id,this.pageCountDetalles,this.pageActualDetalles),this.validatePageDetalles()}validatePageDetalles(){this.disablePageLeftDetalles=1!=this.pageActualDetalles,this.disablePageRightDetalles=!(this.pageActualDetalles>=this.ultimaPageDetalles)}agregarProducto(){const e={producto_id:this.id,cantidad:this.formCreateDetalle.get("cantidad").value};this.productsService.createDetalle(e).subscribe(o=>{"success"==o.code?(this.productoModalAgregar=!1,this.getDetallesProducto(this.id),c().fire({title:"Exito",text:"Producto agregado correctamente",icon:"success"}),this.formCreateDetalle.reset()):(this.productoModalAgregar=!1,c().fire({title:"Error",text:"No se pudo agregar el producto",icon:"error"}))})}eliminarProducto(e){c().fire({title:"Advertencia",text:"\xbfEst\xe1 seguro de eliminar \xe9ste registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(o=>{o.isConfirmed&&this.productsService.deleteDetalle({id:e}).subscribe(a=>{"success"==a.code?(this.getDetallesProducto(this.id),c().fire({title:"Exito",text:"Producto eliminado correctamente",icon:"success"})):c().fire({title:"Error",text:"No se pudo eliminar el producto",icon:"error"})})})}operacion(e){return 2==e?"Ingresado":3==e?"Consumido":0==e?"Anulado":"Operacion no identificada"}tipo_operacion_name(e){return this.tipo_operacion.filter(i=>i.id==e)[0].nombre}getColor(e){switch(this.operacion(e)){case"Ingresado":return"#52D328";case"Consumido":return"red";default:return"black"}}totalDisponible(){let e=0;return this.dataDetails.forEach(o=>{2==o.estado?e+=o.cantidad:3==o.estado&&(e-=o.cantidad)}),e}submitCreate(){this.impuestoModalCrear=!1,0==this.impuestosData.filter(o=>o?.id==this.formCreate.get("impuesto").value.id).length?this.impuestosData.push({nombre:this.formCreate.get("impuesto").value.nombre,porcentaje:this.formCreate.get("impuesto").value.porcentaje,id:this.formCreate.get("impuesto").value.id}):c().fire({title:"Advertecia",text:"El Impuesto ya fue agregado.",icon:"warning"})}openModalCrear(){this.impuestoModalCrear=!0,this.getImpuestoCrear()}openModalAgregar(){this.productoModalAgregar=!0}onChangeCreateImpuesto(){}confirmDelete(e){this.impuestosData=this.impuestosData.filter(o=>o.id!=e)}loadImpuesto(e=this.pageCountImpuestos,o=1,i=""){this.productsService.getImpuesto(this.id,e,o,i).subscribe(a=>{this.impuestosData=a.impuestoProducto.data.map(n=>({nombre:n.impuesto.nombre,porcentaje:n.impuesto.porcentaje,id:n.impuesto_id})),this.ultimaPageImpuestos=a.impuestoProducto.last_page,this.registrosContarImpuestos=a.impuestoProducto.total,this.validatePageImpuestos()},a=>{console.log("Error: ",a)})}searchInputImpuestos(){let e=this.formSearch.get("search").value;this.pageActualImpuestos=1,""==e&&this.loadImpuesto(this.pageCountImpuestos,this.pageActualImpuestos,e)}searchImpuestos(){let e=this.formSearch.get("search").value;this.pageActualImpuestos=1,this.loadImpuesto(this.pageCountImpuestos,this.pageActualImpuestos,e)}onPageImpuestos(e){this.pageActualImpuestos=e.page+1,this.pageCountImpuestos=e.rows,this.loadImpuesto(this.pageCountImpuestos,this.pageActualImpuestos,this.formSearch.get("search").value)}buscarPorTeclaImpuestos(e){"Enter"==e.code&&this.searchImpuestos()}leftTableImpuestos(){this.pageActualImpuestos--,this.loadImpuesto(this.pageCountImpuestos,this.pageActualImpuestos),this.validatePageImpuestos()}rightTableImpuestos(){this.pageActualImpuestos++,this.loadImpuesto(this.pageCountImpuestos,this.pageActualImpuestos),this.validatePageImpuestos()}validatePageImpuestos(){this.disablePageLeftImpuestos=1!=this.pageActualImpuestos,this.disablePageRightImpuestos=!(this.pageActualImpuestos>=this.ultimaPageImpuestos)}getImpuestoCrear(){this.spinner.show(),this.productsService.getImpuestoCrear().subscribe(e=>{this.spinner.hide(),this.impuestos=e.impuestos})}saveImpuesto(e){this.productsService.createImpuesto(e).subscribe(o=>{o.val?(c().fire({title:"Exito",text:o.msm,icon:"success"}),this.router.navigate(["/dashboard/products"])):c().fire({title:"Error",text:o.msm,icon:"error"})})}enviarImpuesto(){this.saveImpuesto({impuestos:this.impuestosData,id:this.id})}static#t=this.\u0275fac=function(o){return new(o||r)(t.Y36(l.qu),t.Y36(A),t.Y36(v.t2),t.Y36(f.gz),t.Y36(f.F0))};static#e=this.\u0275cmp=t.Xpm({type:r,selectors:[["app-products-tribute"]],decls:58,vars:26,consts:[["type","ball-scale-multiple",3,"fullScreen"],[1,"card","mb-3"],[1,"surface-section","px-2","pt-3","md:px-6","lg:px-8"],[1,"flex","align-items-start","flex-column","lg:justify-content-between","lg:flex-column"],[1,"flex"],["pButton","","pRipple","","label","","icon","pi pi-arrow-left",1,"p-button-outlined","mr-4",3,"routerLink"],[1,"flex","align-items-center","font-medium","text-3xl","text-900"],[3,"formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-6","md:col-4"],["type","text","formControlName","nombreProducto","pInputText","",1,"w-full","mb-3","border-round-3xl"],["type","text","formControlName","precio","pInputText","",1,"w-full","mb-3","border-round-3xl"],["type","text","formControlName","medida","pInputText","",1,"w-full","mb-3","border-round-3xl"],[1,"field","col-12","md:col-4"],["type","text","pInputText","","disabled","true",1,"w-full","mb-3","border-round-3xl",3,"value"],[1,"card"],["orientation","left"],["header","Detalles Producto","class","line-height-3 m-0",4,"ngIf"],["header","Impuestos Producto","class","line-height-3 m-0",4,"ngIf"],["header","Agregar Producto",3,"visible","modal","draggable","resizable","visibleChange"],[1,"col-12"],[3,"formGroup","ngSubmit"],[1,"field","col-12","md:col-12"],["type","number","min","1","formControlName","cantidad","placeholder","Cantidad","pInputText","",1,"w-full","mb-3","border-round-3xl"],["style","color: red;",4,"ngIf"],["pButton","","pRipple","","label","Agregar producto","icon","pi pi-fw","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl",3,"disabled"],["header","Agregar Impuesto",3,"visible","modal","draggable","resizable","visibleChange"],["formControlName","impuesto","optionLabel","nombre",3,"options","onChange"],["pButton","","pRipple","","label","Agregar Impuesto","icon","pi pi-fw","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl"],["header","Detalles Producto",1,"line-height-3","m-0"],[1,"surface-section","px-4","py-5","md:px-6","lg:px-8"],[1,"flex","align-items-start","flex-column","lg:justify-content-between","lg:flex-row"],[1,"font-medium","text-3xl","text-900"],["pButton","","pRipple","","type","button","icon","pi pi-plus",1,"p-button-rounded","p-button-text",3,"click"],[1,"grid","mt-3"],[1,"card","px-3","py-3"],["responsiveLayout","scroll",3,"value","tableStyle","loading","rows","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","loadingbody"],[2,"text-align","center"],[1,"p-buttonset"],["pButton","","pRipple","","label","","icon","pi pi-arrow-left",3,"disabled","click"],["pButton","","pRipple","",3,"label"],["pButton","","pRipple","","label","","icon","pi pi-arrow-right",3,"disabled","click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[1,"p-inputgroup"],["formControlName","search","pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto",3,"keyup.enter","input"],["type","button","pButton","","pRipple","",1,"pi","pi-search",3,"click"],[3,"ngStyle"],["class","flex gap-2",4,"ngIf"],[4,"ngIf"],["relleno",""],[1,"flex","gap-2"],["icon","pi pi-trash","severity","danger",3,"click"],["colspan","8"],["header","Impuestos Producto",1,"line-height-3","m-0"],[1,"mt-3","lg:mt-0"],["pButton","","pRipple","","label","Guardar","icon","",1,"p-button-outlined","mr-2",3,"click"],["responsiveLayout","scroll",3,"value","tableStyle","loading","rows"],[2,"color","red"]],template:function(o,i){1&o&&(t._UZ(0,"ngx-spinner",0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),t._UZ(5,"button",5),t.TgZ(6,"div",6),t._uU(7," Detalle de Producto "),t.qZA()(),t.TgZ(8,"div")(9,"form",7),t._UZ(10,"br"),t.TgZ(11,"div",8)(12,"div",9)(13,"label"),t._uU(14,"Nombre"),t.qZA(),t._UZ(15,"input",10),t.qZA(),t.TgZ(16,"div",9)(17,"label"),t._uU(18," Precio "),t.qZA(),t._UZ(19,"input",11),t.qZA(),t.TgZ(20,"div",9)(21,"label"),t._uU(22,"Medida"),t.qZA(),t._UZ(23,"br")(24,"input",12),t.qZA(),t.TgZ(25,"div",13)(26,"label"),t._uU(27,"Total productos disponibles"),t.qZA(),t._UZ(28,"br")(29,"input",14),t.qZA()()()()()()(),t.TgZ(30,"div",15)(31,"p-tabView",16),t.YNc(32,Rt,21,9,"p-tabPanel",17),t.YNc(33,$t,23,8,"p-tabPanel",18),t.qZA()(),t.TgZ(34,"p-dialog",19),t.NdJ("visibleChange",function(n){return i.productoModalAgregar=n}),t.TgZ(35,"div",20)(36,"form",21),t.NdJ("ngSubmit",function(){return i.agregarProducto()}),t.TgZ(37,"div",8)(38,"div",22)(39,"label"),t._uU(40,"Agregar"),t.qZA(),t._UZ(41,"input",23),t.YNc(42,Ht,2,0,"div",24),t.qZA(),t.TgZ(43,"div",22),t._UZ(44,"button",25),t.qZA()(),t._UZ(45,"br"),t.qZA()()(),t.TgZ(46,"p-dialog",26),t.NdJ("visibleChange",function(n){return i.impuestoModalCrear=n}),t.TgZ(47,"div",20)(48,"form",21),t.NdJ("ngSubmit",function(){return i.submitCreate()}),t.TgZ(49,"div",8)(50,"div",22)(51,"label"),t._uU(52,"Impuesto"),t.qZA(),t.TgZ(53,"p-dropdown",27),t.NdJ("onChange",function(){return i.onChangeCreateImpuesto()}),t.qZA(),t.YNc(54,jt,2,0,"div",24),t.qZA(),t.TgZ(55,"div",22),t._UZ(56,"button",28),t.qZA()(),t._UZ(57,"br"),t.qZA()()()),2&o&&(t.Q6J("fullScreen",!0),t.xp6(5),t.Q6J("routerLink","/dashboard/products"),t.xp6(4),t.Q6J("formGroup",i.form),t.xp6(20),t.Q6J("value",i.totalDisponible()),t.xp6(3),t.Q6J("ngIf",i.permisoDetalle),t.xp6(1),t.Q6J("ngIf",i.permisoImpuesto),t.xp6(1),t.Akn(t.DdM(24,Kt)),t.Q6J("visible",i.productoModalAgregar)("modal",!0)("draggable",!1)("resizable",!1),t.xp6(2),t.Q6J("formGroup",i.formCreateDetalle),t.xp6(6),t.Q6J("ngIf",i.formCreateDetalle.get("cantidad").hasError("required")),t.xp6(2),t.Q6J("disabled",i.formCreateDetalle.invalid),t.xp6(2),t.Akn(t.DdM(25,Ot)),t.Q6J("visible",i.impuestoModalCrear)("modal",!0)("draggable",!1)("resizable",!1),t.xp6(2),t.Q6J("formGroup",i.formCreate),t.xp6(5),t.Q6J("options",i.impuestos),t.xp6(1),t.Q6J("ngIf",i.formCreate.get("impuesto").hasError("required")))},dependencies:[h.O5,h.PC,f.rH,P.iA,D.jx,b.Hq,b.zx,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.qQ,C.H,T.o,Z.Lt,x.V,l.sg,l.u,v.Ro,I.xf,I.x4]})}return r})();var y=d(2506);let Xt=(()=>{class r{static#t=this.\u0275fac=function(o){return new(o||r)};static#e=this.\u0275mod=t.oAB({type:r});static#i=this.\u0275inj=t.cJS({imports:[f.Bz.forChild([{path:"",component:Jt,canActivate:[y.a],data:{permissions:["gestionInventario.productos"]}},{path:":id/impuesto",component:zt,canActivate:[y.a],data:{permissions:["gestionInventario.productos.detalle","gestionInventario.productos.impuestoProducto"]}}]),f.Bz]})}return r})();var Wt=d(1712),te=d(3514);let ee=(()=>{class r{static#t=this.\u0275fac=function(o){return new(o||r)};static#e=this.\u0275mod=t.oAB({type:r});static#i=this.\u0275inj=t.cJS({providers:[{provide:w.TP,useClass:Y.n,multi:!0},A],imports:[h.ez,Xt,P.U$,E.O,l.u5,b.hJ,C.T,S.EV,Q.V,V.Xt,T.j,U.A,Z.kW,k.cc,M.L$,x.S,R.ii.forRoot(),l.UX,v.ef,Wt.U,te.dp,I.LU]})}return r})()}}]);