"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[21],{2021:(Ce,A,a)=>{a.r(A),a.d(A,{RecipesModule:()=>xe});var g=a(6814),c=a(95),h=a(9664),J=a(6068),u=a(707),f=a(4480),N=a(4104),M=a(6340),S=a(6022),b=a(3714),_=a(6218),v=a(2160),w=a(1865),E=a(354),T=a(7213),Z=a(9862),G=a(8712),F=a(5722),d=a(86),x=a(2791),Q=a(3519),l=a.n(Q),e=a(4946),Y=a(4444);let R=(()=>{class s{constructor(t){this.httpClient=t,this.baseUrl=Y.D.url,this.endpointListar="/recetaListar",this.endpointRecipesGet="/recetaEditar/",this.endpointRecipesUpdate="/recetaActualizar/",this.endpointRecipesCreate="/recetaCrear",this.endpointDelete="/recetaEliminar",this.endpointProductsGet="/getRecetaProductos/",this.endpointProductsCreate="/agregarProductosReceta",this.endpointAllProductsGet="/getAllProductosByRecetas/",this.endpointTaxesGet="/getRecetaCrearImpuesto/",this.endpointTaxesByIdGet="/getImpuestoReceta/",this.endpointTaxesCreate="/agregarImpuestoReceta"}getAll(t,o="",i=1){const r={headers:new Z.WM({"Content-Type":"application/json"})};return this.httpClient.post(`${this.baseUrl+this.endpointListar}?per_page=${t}&page=${i}&search=${o}`,r)}getRecipes(t){return this.httpClient.get(`${this.baseUrl+this.endpointRecipesGet+t}`)}createRecipes(t){return this.httpClient.post(`${this.baseUrl+this.endpointRecipesCreate}`,t)}updateRecipes(t){return this.httpClient.post(`${this.baseUrl+this.endpointRecipesUpdate}`,t)}deleteRecipes(t){return this.httpClient.post(`${this.baseUrl+this.endpointDelete}`,t)}getProducts(t){return this.httpClient.get(`${this.baseUrl+this.endpointProductsGet+t}`)}getProductsRecetas(t){return this.httpClient.get(`${this.baseUrl+this.endpointAllProductsGet+t}`)}createRecipesProducts(t){return this.httpClient.post(`${this.baseUrl+this.endpointProductsCreate}`,t)}getTaxes(t){return this.httpClient.get(`${this.baseUrl+this.endpointTaxesGet+t}`)}getRecipeTaxes(t){return this.httpClient.get(`${this.baseUrl+this.endpointTaxesByIdGet+t}`)}createTaxes(t){return this.httpClient.post(`${this.baseUrl+this.endpointTaxesCreate}`,t)}static#e=this.\u0275fac=function(o){return new(o||s)(e.LFG(Z.eN))};static#t=this.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var m=a(8672),P=a(5219);function B(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.openModal())}),e.qZA()}}function D(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"div",33),e._UZ(1,"span"),e.TgZ(2,"span",34)(3,"form",35)(4,"div",36)(5,"input",37),e.NdJ("input",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.searchInput())}),e.qZA(),e.TgZ(6,"button",38),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.search(i.dt))}),e.qZA()()()()()}if(2&s){const t=e.oxw();e.xp6(3),e.Q6J("formGroup",t.formSearch)}}function k(s,n){1&s&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Hotel"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Nombre"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Precio"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Descripci\xf3n"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Acciones"),e.qZA()())}function L(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"p-button",43),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,r=e.oxw();return e.KtG(r.editRecipes(i.id))}),e.qZA()}}function $(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"p-button",44),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,r=e.oxw();return e.KtG(r.redirectToRecipesProducts(i.id))}),e.qZA()}}function O(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"p-button",45),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,r=e.oxw();return e.KtG(r.confirmDelete(i.id))}),e.qZA()}}function H(s,n){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.ALo(7,"currency"),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td",39),e.YNc(11,L,1,0,"p-button",40),e.YNc(12,$,1,0,"p-button",41),e.YNc(13,O,1,0,"p-button",42),e.qZA()()),2&s){const t=n.$implicit,o=e.oxw();e.xp6(2),e.Oqu(t.hotel.nombre),e.xp6(2),e.hij("",t.nombre," "),e.xp6(2),e.Oqu(e.gM2(7,7,t.precio,"COP","","1.0-0")),e.xp6(3),e.Oqu(t.descripcion),e.xp6(2),e.Q6J("ngIf",o.permisoActualizar),e.xp6(1),e.Q6J("ngIf",o.permisoActualizar),e.xp6(1),e.Q6J("ngIf",o.permisoEliminar)}}function z(s,n){1&s&&(e.TgZ(0,"tr")(1,"td",46),e._uU(2,"Cargando informacion porfavor espere ..."),e.qZA()())}function j(s,n){1&s&&(e.TgZ(0,"div",47),e._uU(1,"Campo requerido"),e.qZA())}function V(s,n){1&s&&(e.TgZ(0,"div",47),e._uU(1,"Campo requerido"),e.qZA())}function K(s,n){1&s&&(e.TgZ(0,"div",47),e._uU(1,"Campo requerido"),e.qZA())}function X(s,n){1&s&&(e.TgZ(0,"div",47),e._uU(1,"Campo requerido"),e.qZA())}function W(s,n){1&s&&(e.TgZ(0,"div",47),e._uU(1,"Campo requerido"),e.qZA())}function ee(s,n){1&s&&(e.TgZ(0,"div",47),e._uU(1,"Campo requerido"),e.qZA())}function te(s,n){1&s&&(e.TgZ(0,"div",47),e._uU(1,"Campo requerido"),e.qZA())}function ie(s,n){1&s&&(e.TgZ(0,"div",47),e._uU(1,"Campo requerido"),e.qZA())}const oe=function(){return{"min-width":"50rem"}},se=function(){return["nombre","Hotel","acciones"]},q=function(){return{width:"50vw"}};let re=(()=>{class s{constructor(t,o,i,r){this.recipesService=t,this.FB=o,this.spinner=i,this.router=r,this.permisoCrear=x.e.hasPermission(["gestionInventario.recetas.crear"]),this.permisoActualizar=x.e.hasPermission(["gestionInventario.recetas.actualizar"]),this.permisoEliminar=x.e.hasPermission(["gestionInventario.recetas.eliminar"]),this.loadingTable=!1,this.visibleModalRecipes=!0,this.visibleModalRecipesEditar=!1,this.imagen=null,this.idEditando=0,this.pageCount=10,this.first=0,this.rows=8,this.pageActual=1,this.ultimaPage=1,this.disablePageLeft=!1,this.disablePageRight=!1}ngOnInit(){this.buildForm(),this.getIndex(),this.visibleModalRecipes=!1}redirectToRecipesProducts(t){this.router.navigate(["/dashboard/admin/recipes/"+t+"/recipes-products"])}openModal(){this.onCreate()}onCreate(){this.formCreateRecipes.reset(),this.recipesService.getRecipes(0).subscribe(t=>{this.hotel=t.hotel,this.nombre=t.nombre,this.recipesDescripcion=t.descripcion,this.precio=t.precio,this.visibleModalRecipes=!0},t=>{console.log("Error: ",t)})}newRecipes(){this.spinner.show();let t=this.formCreateRecipes.value;t.hotel_id=t.hotel_id.id,t.estado=1,this.recipesService.createRecipes(t).subscribe(o=>{this.spinner.hide(),this.imagen=null,this.visibleModalRecipes=!1,"success"==o.code?(l().fire({title:"\xc9xito",text:"Receta creada exitosamente.",icon:"success"}),this.getIndex()):l().fire({title:"Error",text:"Error al crear la receta.",icon:"error"})},o=>{console.log("Error: ",o)})}submitCreate(){this.formCreateRecipes.valid?this.newRecipes():this.formCreateRecipes.markAllAsTouched()}editRecipes(t){this.idEditando=t,this.spinner.show(),this.recipesService.getRecipes(t).subscribe(o=>{this.spinner.hide(),this.hotel=o.hotel;const i=o.receta;i&&(this.nombre=i.nombre,this.recipesDescripcion=i.descripcion,this.precio=parseFloat(i.precio),this.formEditRecipes.setValue({hotel_id:this.hotel,precio:this.precio,descripcion:this.recipesDescripcion,nombre:this.nombre})),setTimeout(()=>{this.visibleModalRecipesEditar=!0},1)},o=>{console.log("Error: ",o)})}updateRecipe(){this.spinner.show();let t=this.formEditRecipes.value;t.hotel_id=t.hotel_id.id,t.nombre=t.nombre,t.descripcion=t.descripcion,t.precio=t.precio,t.id=this.idEditando,t.estado=1,this.recipesService.updateRecipes(t).subscribe(o=>{this.spinner.hide(),this.imagen=null,this.visibleModalRecipesEditar=!1,"success"==o.code?(l().fire({title:"\xc9xito",text:"Receta actualizado exitosamente.",icon:"success"}),this.getIndex()):l().fire({title:"Error",text:"Error al actualizar la receta.",icon:"error"})},o=>{console.log("Error: ",o)})}submitUpdate(){this.formEditRecipes.valid&&this.updateRecipe()}confirmDelete(t){l().fire({title:"\xbfEstas seguro que deseas eliminar esta receta?",text:"Ten cuidado esta acci\xf3n no se prodr\xe1 reversar",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xed, Confirmar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&(this.spinner.show(),this.recipesService.deleteRecipes({id:t}).subscribe(i=>{this.spinner.hide(),"success"==i.code?(l().fire({title:"Exito",text:"Receta eliminada exitosamente.",icon:"success"}),this.getIndex()):l().fire({title:"Error",text:"Error al eliminar la receta.",icon:"error"})},i=>{console.log("Error: ",i)}))})}buildForm(){this.formSearch=this.FB.group({search:["",[]]}),this.formCreateRecipes=this.FB.group({hotel_id:["",[c.kI.required]],nombre:["",[c.kI.required]],precio:["",[c.kI.required]],descripcion:["",[]]}),this.formEditRecipes=this.FB.group({hotel_id:["",[c.kI.required]],nombre:["",[c.kI.required]],precio:["",[c.kI.required]],descripcion:["",[]]})}getIndex(t="",o=this.pageCount,i=1){this.spinner.show(),this.loadingTable=!0,this.recipesService.getAll(o,t,i).subscribe(r=>{this.loadingTable=!1,this.recipesData=r.data,this.ultimaPage=r.last_page,this.countRegisters=r.total,this.ultimaPage=r.last_page,r.total>o&&(this.disablePageRight=!0),this.validatePage(),this.spinner.hide()},r=>{console.log("Error: ",r)})}onRemove(t){this.imagen=null}onSelect(t){this.imagen=t.currentFiles[0]}onPage(t){this.pageCount=t.rows,this.getIndex("",this.pageCount)}searchInput(){let t=this.formSearch.get("search").value;""==t&&this.getIndex(t)}search(t){let o=this.formSearch.get("search").value;this.getIndex(o)}onPageChange(t){this.first=t.first,this.rows=t.rows}leftTable(){this.pageActual=this.pageActual-1,this.getIndex("",this.pageCount,this.pageActual),this.validatePage()}rightTable(){this.pageActual=this.pageActual+1,this.getIndex("",this.pageCount,this.pageActual),this.validatePage()}validatePage(){1==this.pageActual&&(this.disablePageLeft=!1),this.pageActual>1&&(this.disablePageLeft=!0),this.ultimaPage==this.pageActual&&(this.disablePageRight=!1),this.ultimaPage>this.pageActual&&(this.disablePageRight=!0)}static#e=this.\u0275fac=function(o){return new(o||s)(e.Y36(R),e.Y36(c.qu),e.Y36(m.t2),e.Y36(d.F0))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["app-recipes"]],decls:76,vars:40,consts:[["type","ball-scale-multiple"],[1,"surface-section","px-4","py-5","md:px-6","lg:px-8"],[1,"flex","align-items-start","flex-column","lg:justify-content-between","lg:flex-row"],[1,"font-medium","text-3xl","text-900"],[1,"mt-3","lg:mt-0"],["pButton","","pRipple","","label","Crear","class","p-button-outlined mr-2","icon","",3,"click",4,"ngIf"],[1,"grid","mt-3"],[1,"col-12"],[1,"card","px-3","py-3"],["responsiveLayout","scroll","selectionMode","multiple","dataKey","usuario",3,"value","tableStyle","loading","rows","globalFilterFields","rowHover","onPage"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","loadingbody"],[2,"text-align","center"],[1,"p-buttonset"],["pButton","","pRipple","","label","","icon","pi pi-arrow-left",3,"disabled","click"],["pButton","","pRipple","",3,"label"],["pButton","","pRipple","","label","","icon","pi pi-arrow-right",3,"disabled","click"],["header","Crear Receta",3,"visible","modal","draggable","resizable","visibleChange"],[3,"formGroup","ngSubmit"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12","md:col-6"],["optionLabel","nombre","formControlName","hotel_id",3,"options"],["style","color: red;",4,"ngIf"],["type","text","pInputText","","formControlName","nombre",1,"w-full","mb-3","border-round-3xl"],["type","number","min","1","pInputText","","formControlName","precio",1,"w-full","mb-3","border-round-3xl"],[1,"field","col-12","md:col-12"],["type","text","pInputTextarea","","rows","3","cols","20","formControlName","descripcion"],["pButton","","pRipple","","label","Crear Receta","icon","","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl",3,"disabled"],["header","Editar Recetas",3,"visible","modal","draggable","resizable","visibleChange"],["pButton","","pRipple","","label","Editar Receta","icon","","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl",3,"disabled"],["pButton","","pRipple","","label","Crear","icon","",1,"p-button-outlined","mr-2",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[3,"formGroup"],[1,"p-inputgroup"],["formControlName","search","pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto",3,"input"],["type","button","pButton","","pRipple","",1,"pi","pi-search",3,"click"],[1,"flex","gap-2"],["icon","pi pi-pencil","severity","info",3,"click",4,"ngIf"],["icon","pi pi-cog","severity","info",3,"click",4,"ngIf"],["icon","pi pi-trash","severity","danger",3,"click",4,"ngIf"],["icon","pi pi-pencil","severity","info",3,"click"],["icon","pi pi-cog","severity","info",3,"click"],["icon","pi pi-trash","severity","danger",3,"click"],["colspan","8"],[2,"color","red"]],template:function(o,i){1&o&&(e._UZ(0,"ngx-spinner",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div")(4,"div",3),e._uU(5,"Recetas"),e.qZA()(),e.TgZ(6,"div",4),e.YNc(7,B,1,0,"button",5),e.qZA()()(),e.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"p-table",9),e.NdJ("onPage",function(p){return i.onPage(p)}),e.YNc(12,D,7,1,"ng-template",10),e.YNc(13,k,11,0,"ng-template",11),e.YNc(14,H,14,12,"ng-template",12),e.YNc(15,z,3,0,"ng-template",13),e.qZA(),e._UZ(16,"br"),e.TgZ(17,"div",14)(18,"span",15)(19,"button",16),e.NdJ("click",function(){return i.leftTable()}),e.qZA(),e._UZ(20,"button",17),e.TgZ(21,"button",18),e.NdJ("click",function(){return i.rightTable()}),e.qZA()()()()()(),e.TgZ(22,"p-dialog",19),e.NdJ("visibleChange",function(p){return i.visibleModalRecipes=p}),e.TgZ(23,"div",7)(24,"form",20),e.NdJ("ngSubmit",function(){return i.submitCreate()}),e.TgZ(25,"div",21)(26,"div",22)(27,"label"),e._uU(28,"Hotel"),e.qZA(),e._UZ(29,"p-dropdown",23),e.YNc(30,j,2,0,"div",24),e.qZA(),e.TgZ(31,"div",22)(32,"label"),e._uU(33,"Nombre"),e.qZA(),e._UZ(34,"input",25),e.YNc(35,V,2,0,"div",24),e.qZA(),e.TgZ(36,"div",22)(37,"label"),e._uU(38,"Precio"),e.qZA(),e._UZ(39,"input",26),e.YNc(40,K,2,0,"div",24),e.qZA(),e.TgZ(41,"div",27)(42,"label"),e._uU(43,"Descripcion"),e.qZA(),e._UZ(44,"textarea",28),e.YNc(45,X,2,0,"div",24),e.qZA(),e.TgZ(46,"div",27),e._UZ(47,"button",29),e.qZA()(),e._UZ(48,"br"),e.qZA()()(),e.TgZ(49,"p-dialog",30),e.NdJ("visibleChange",function(p){return i.visibleModalRecipesEditar=p}),e.TgZ(50,"div",7)(51,"form",20),e.NdJ("ngSubmit",function(){return i.submitUpdate()}),e.TgZ(52,"div",21)(53,"div",22)(54,"label"),e._uU(55,"Hotel"),e.qZA(),e._UZ(56,"p-dropdown",23),e.YNc(57,W,2,0,"div",24),e.qZA(),e.TgZ(58,"div",22)(59,"label"),e._uU(60,"Nombre"),e.qZA(),e._UZ(61,"input",25),e.YNc(62,ee,2,0,"div",24),e.qZA(),e.TgZ(63,"div",22)(64,"label"),e._uU(65,"Precio"),e.qZA(),e._UZ(66,"input",26),e.YNc(67,te,2,0,"div",24),e.qZA(),e.TgZ(68,"div",27)(69,"label"),e._uU(70,"Descripcion"),e.qZA(),e._UZ(71,"textarea",28),e.YNc(72,ie,2,0,"div",24),e.qZA(),e.TgZ(73,"div",27),e._UZ(74,"button",31),e.qZA()(),e._UZ(75,"br"),e.qZA()()()),2&o&&(e.xp6(7),e.Q6J("ngIf",i.permisoCrear),e.xp6(4),e.Q6J("value",i.recipesData)("tableStyle",e.DdM(36,oe))("loading",i.loadingTable)("rows",8)("globalFilterFields",e.DdM(37,se))("rowHover",!0),e.xp6(8),e.Q6J("disabled",!i.disablePageLeft),e.xp6(1),e.Q6J("label",i.pageActual),e.xp6(1),e.Q6J("disabled",!i.disablePageRight),e.xp6(1),e.Akn(e.DdM(38,q)),e.Q6J("visible",i.visibleModalRecipes)("modal",!0)("draggable",!1)("resizable",!1),e.xp6(2),e.Q6J("formGroup",i.formCreateRecipes),e.xp6(5),e.Q6J("options",i.hotel),e.xp6(1),e.Q6J("ngIf",i.formCreateRecipes.get("hotel_id").hasError("required")),e.xp6(5),e.Q6J("ngIf",i.formCreateRecipes.get("nombre").hasError("required")),e.xp6(5),e.Q6J("ngIf",i.formCreateRecipes.get("precio").hasError("required")),e.xp6(5),e.Q6J("ngIf",i.formCreateRecipes.get("descripcion").hasError("required")),e.xp6(2),e.Q6J("disabled",i.formCreateRecipes.invalid),e.xp6(2),e.Akn(e.DdM(39,q)),e.Q6J("visible",i.visibleModalRecipesEditar)("modal",!0)("draggable",!1)("resizable",!1),e.xp6(2),e.Q6J("formGroup",i.formEditRecipes),e.xp6(5),e.Q6J("options",i.hotel),e.xp6(1),e.Q6J("ngIf",i.formEditRecipes.get("hotel_id").hasError("required")),e.xp6(5),e.Q6J("ngIf",i.formEditRecipes.get("nombre").hasError("required")),e.xp6(5),e.Q6J("ngIf",i.formEditRecipes.get("precio").hasError("required")),e.xp6(5),e.Q6J("ngIf",i.formEditRecipes.get("descripcion").hasError("required")),e.xp6(2),e.Q6J("disabled",i.formEditRecipes.invalid))},dependencies:[g.O5,h.iA,P.jx,u.Hq,u.zx,c._Y,c.Fj,c.wV,c.JJ,c.JL,c.qQ,f.H,b.o,_.g,v.Lt,T.V,c.sg,c.u,m.Ro,g.H9],styles:["svg[_ngcontent-%COMP%]{width:45%}"]})}return s})();var C=a(4844);function ae(s,n){1&s&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Nombre del Producto"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Medida"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Cantidad"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Descripci\xf3n"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Acciones"),e.qZA()())}function ne(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td")(10,"p-button",42),e.NdJ("click",function(){const r=e.CHM(t).$implicit,p=e.oxw();return e.KtG(p.quitarProducto(r))}),e.qZA()()()}if(2&s){const t=n.$implicit;e.xp6(2),e.Oqu(t.nombre),e.xp6(2),e.Oqu(null==t?null:t.medida),e.xp6(2),e.Oqu(t.cantidad),e.xp6(2),e.Oqu(t.descripcion)}}function ce(s,n){1&s&&(e.TgZ(0,"tr")(1,"td",43),e._uU(2,"Cargando informacion porfavor espere ..."),e.qZA()())}function pe(s,n){1&s&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Nombre"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Porcentaje"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Acciones"),e.qZA()())}function le(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td")(6,"p-button",42),e.NdJ("click",function(){const r=e.CHM(t).$implicit,p=e.oxw();return e.KtG(p.quitarTaxes(r))}),e.qZA()()()}if(2&s){const t=n.$implicit;e.xp6(2),e.Oqu(t.nombre),e.xp6(2),e.Oqu(t.porcentaje)}}function de(s,n){1&s&&(e.TgZ(0,"tr")(1,"td",43),e._uU(2,"Cargando informacion porfavor espere ..."),e.qZA()())}function ue(s,n){if(1&s&&(e.TgZ(0,"div",44)(1,"span",45),e._uU(2),e.qZA()()),2&s){const t=n.$implicit;e.xp6(2),e.Oqu(t.nombre)}}function me(s,n){1&s&&(e.TgZ(0,"div",46),e._uU(1,"Campo requerido"),e.qZA())}function ge(s,n){1&s&&(e.TgZ(0,"div",46),e._uU(1,"Campo requerido "),e.qZA())}function he(s,n){1&s&&(e.TgZ(0,"div",46),e._uU(1,"La cantidad debe ser al menos 1."),e.qZA())}function fe(s,n){if(1&s&&(e.TgZ(0,"div",44)(1,"span",45),e._uU(2),e.qZA()()),2&s){const t=n.$implicit;e.xp6(2),e.Oqu(t.nombre)}}function be(s,n){1&s&&(e.TgZ(0,"div",46),e._uU(1,"Campo requerido"),e.qZA())}const U=function(){return{"min-width":"50rem"}},I=function(){return{width:"50vw"}};let _e=(()=>{class s{constructor(t,o,i,r,p,Re){this.recipesService=t,this.FB=o,this.spinner=i,this.router=r,this.route=p,this.cdr=Re,this.productsData=[],this.loadingTable=!1,this.productoVisible=!1,this.productosSeleccionados=[],this.displayModalProducts=!1,this.displayModalTaxes=!1,this.taxesData=[],this.impuestosSeleccionados=[],this.pageCount=10,this.first=0,this.rows=8,this.pageActual=1,this.ultimaPage=1,this.disablePageLeft=!1,this.disablePageRight=!1}ngOnInit(){this.spinner.hide(),this.dataRecipesDetail=[],this.buildForm(),this.recetaId=parseFloat(this.route.snapshot.paramMap.get("id")),this.getProductsAndRecipesList(this.recetaId),this.getProductsForRecipe(this.recetaId),this.getTaxesAndRecipesList(this.recetaId),this.getTaxesById(this.recetaId)}buildForm(){this.form=this.FB.group({nombreReceta:[this.dataRecipesDetail?.detalleRecipes?.recipes?.nombre,[]],descripcion:[this.dataRecipesDetail?.detalleRecipes?.descripcion,[]],precio:[this.dataRecipesDetail?.detalleRecipes?.precio,[]]}),this.formImpuesto=this.FB.group({impuesto_id:[null,c.kI.required],nombre:[""],porcentaje:[""]}),this.form.get("nombreReceta").disable(),this.form.get("descripcion").disable(),this.form.get("precio").disable(),this.formProducto=this.FB.group({producto_id:[null,[c.kI.required]],cantidad:[1,[c.kI.required,c.kI.min(1)]]}),this.formTaxes=this.FB.group({impuesto_id:[null,[c.kI.required]]})}openModal(){this.displayModalProducts=!0}closeModal(){this.displayModalProducts=!1}getProductsAndRecipesList(t){this.loadingTable=!0,this.recipesService.getProducts(t).subscribe(o=>{this.productsData=o.productos,this.loadingTable=!1;const i=Number(o.receta.precio).toLocaleString("es-CO");this.form.get("nombreReceta").setValue(o.receta.nombre),this.form.get("precio").setValue(`$${i}`),this.form.get("descripcion").setValue(o.receta.descripcion)},o=>{console.error(o),this.loadingTable=!1})}onCantidadChange(t){this.formProducto.controls.cantidad.setValue(t.target.value)}agregarProductos(){const t=this.formProducto.get("producto_id").value,o=this.formProducto.get("cantidad").value;t?(this.productosGuardados=this.productosGuardados||[],this.productosSeleccionados=this.productosSeleccionados||[],t.cantidad=Number(o),this.productosSeleccionados.push({producto_id:t.id,nombre:t.nombre,descripcion:t.descripcion,cantidad:Number(o),medida:t.medida.nombre}),this.productosParaMostrar=[...this.productosGuardados,...this.productosSeleccionados],this.cdr.detectChanges(),this.formProducto.get("producto_id").setValue(null),this.formProducto.get("cantidad").setValue(0),this.closeModal()):console.error("Por favor, selecciona un producto antes de agregar.")}getProductsForRecipe(t){this.loadingTable=!0,this.recipesService.getProductsRecetas(t).subscribe(o=>{this.productosGuardados=o&&o.receta&&o.receta.length>0?o.receta.map(i=>({id:i.productos.id,nombre:i.productos.nombre,cantidad:i.cantidad,descripcion:i.productos.descripcion,medida:i.productos.medida.nombre})):[],this.productosParaMostrar=[...this.productosGuardados,...this.productosSeleccionados],this.loadingTable=!1},o=>{console.error(o),this.loadingTable=!1})}sendProducts(){const t=[...this.productosGuardados,...this.productosSeleccionados];if(Array.isArray(t)){let o={receta_id:this.recetaId,producto:t.map(i=>({producto_id:i.producto_id?i.producto_id:i.id,cantidad:String(i.cantidad)}))};this.recipesService.createRecipesProducts(o).subscribe(i=>{i.val&&this.getProductsForRecipe(this.recetaId)},i=>{console.error(i),l().fire({title:"Error",text:"Hubo un error al guardar los productos.",icon:"error"})})}else l().fire({title:"Error",text:"Hubo un error al guardar los productos.",icon:"error"});l().fire({title:"Exito",text:"Los productos se han guardado correctamente.",icon:"success"})}quitarProducto(t){let o=this.productosSeleccionados.findIndex(i=>i===t);-1!==o?this.productosSeleccionados.splice(o,1):(o=this.productosGuardados.findIndex(i=>i===t),-1!==o&&this.productosGuardados.splice(o,1)),this.productosParaMostrar=[...this.productosGuardados,...this.productosSeleccionados],this.cdr.detectChanges()}openModalTaxes(){this.displayModalTaxes=!0}closeModalTaxes(){this.displayModalTaxes=!1}getTaxesAndRecipesList(t){this.loadingTable=!0,this.recipesService.getTaxes(t).subscribe(o=>{this.taxesData=o.impuesto,this.loadingTable=!1},o=>{console.error(o),this.loadingTable=!1})}agregarImpuestos(){const t=this.formImpuesto.get("impuesto_id").value.id,o=this.taxesData.find(i=>i.id===t);o?(this.impuestosGuardados=this.impuestosGuardados||[],this.impuestosSeleccionados=this.impuestosSeleccionados||[],this.impuestosSeleccionados.push({impuesto_id:o.id,nombre:o.nombre,porcentaje:Number(o.porcentaje)}),this.impuestosParaMostrar=[...this.impuestosGuardados,...this.impuestosSeleccionados],this.cdr.detectChanges(),this.formImpuesto.get("impuesto_id").setValue(null),this.closeModalTaxes()):console.error("Por favor, selecciona un impuesto antes de agregar.")}getTaxesById(t){this.loadingTable=!0,this.recipesService.getRecipeTaxes(t).subscribe(o=>{this.impuestosGuardados=o&&o.receta_impuesto&&o.receta_impuesto.length>0?o.receta_impuesto.map(i=>({id:i.impuesto.id,nombre:i.impuesto.nombre,porcentaje:i.impuesto.porcentaje})):[],this.impuestosParaMostrar=[...this.impuestosGuardados,...this.impuestosSeleccionados],this.loadingTable=!1},o=>{console.error(o),this.loadingTable=!1})}sendTaxes(){if(Array.isArray(this.impuestosSeleccionados)){let t={receta_id:this.recetaId,impuestos:Array.isArray(this.impuestosSeleccionados)?this.impuestosSeleccionados.map(o=>({impuesto_id:o.impuesto_id})):[]};this.recipesService.createTaxes(t).subscribe(o=>{o.val&&this.getTaxesById(this.recetaId)},o=>{console.error(o),l().fire({title:"Error",text:"Hubo un error al guardar los impuestos.",icon:"error"})})}else l().fire({title:"Error",text:"Por favor, agrega al menos un impuesto a la receta antes de guardar.",icon:"error"});l().fire({title:"Exito",text:"Los impuestos se han guardado correctamente.",icon:"success"})}quitarTaxes(t){let o=this.impuestosSeleccionados.findIndex(i=>i===t);-1!==o?this.impuestosSeleccionados.splice(o,1):(o=this.impuestosGuardados.findIndex(i=>i===t),-1!==o&&this.impuestosGuardados.splice(o,1)),this.impuestosParaMostrar=[...this.impuestosGuardados,...this.impuestosSeleccionados],this.cdr.detectChanges()}onPage(t){this.pageCount=t.rows}onPageChange(t){this.first=t.first,this.rows=t.rows}leftTable(){this.pageActual=this.pageActual-1,this.validatePage()}rightTable(){this.pageActual=this.pageActual+1,this.validatePage()}validatePage(){1==this.pageActual&&(this.disablePageLeft=!1),this.pageActual>1&&(this.disablePageLeft=!0),this.ultimaPage==this.pageActual&&(this.disablePageRight=!1),this.ultimaPage>this.pageActual&&(this.disablePageRight=!0)}static#e=this.\u0275fac=function(o){return new(o||s)(e.Y36(R),e.Y36(c.qu),e.Y36(m.t2),e.Y36(d.F0),e.Y36(d.gz),e.Y36(e.sBO))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["app-recipes-products"]],decls:91,vars:40,consts:[["type","ball-scale-multiple",3,"fullScreen"],[1,"card","mb-1"],[1,"surface-section","px-2","pt-3","md:px-6","lg:px-8"],[1,"flex","align-items-start","flex-column","lg:justify-content-between","lg:flex-row"],[1,"flex"],["pButton","","pRipple","","label","","icon","pi pi-arrow-left",1,"p-button-outlined","mr-4",3,"routerLink"],[1,"flex","align-items-center","font-medium","text-3xl","text-900"],[3,"formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12","md:col-6"],["type","text","formControlName","nombreReceta","pInputText","",1,"w-full","mb-3","border-round-3xl"],[1,"field","col-12","md:col-3"],["type","text","formControlName","precio","pInputText","",1,"w-full","mb-3","border-round-3xl"],[1,"field","col-12","md:col-12"],["formControlName","descripcion","pInputTextarea","","rows","3","cols","20"],[1,"card","m-1"],["orientation","left"],["header","Agregar Producto",1,"line-height-3","m-0"],[1,"surface-section","px-4","py-5","md:px-6","lg:px-8"],[1,"font-medium","text-3xl","text-900"],["pButton","","pRipple","","type","button","icon","pi pi-plus",1,"p-button-rounded","p-button-text",3,"click"],[1,"mt-3","lg:mt-0"],["pButton","","pRipple","","label","Guardar","icon","",1,"p-button-outlined","mr-2",3,"click"],[1,"grid","mt-3"],[1,"col-12"],[1,"card","px-3","py-3"],["responsiveLayout","scroll",3,"value","tableStyle","loading","rows"],["pTemplate","header"],["pTemplate","body"],["pTemplate","loadingbody"],["header","Agregar Impuesto",1,"line-height-3","m-0"],["pButton","","pRipple","","label","Guardar",1,"p-button-outlined","mr-2",3,"click"],["header","Agregar Productos",3,"visible","modal","draggable","resizable","visibleChange"],[3,"formGroup","ngSubmit"],["formControlName","producto_id","optionLabel","nombre","placeholder","Buscar Producto",1,"dropdown-custom",3,"options","autoDisplayFirst"],["pTemplate","item"],["style","color: red;",4,"ngIf"],["type","number","formControlName","cantidad","placeholder","Cantidad","pInputText","","min","1",1,"w-full","mb-3","border-round-3xl",3,"change"],["pButton","","pRipple","","label","Agregar Producto","icon","pi pi-fw","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl",3,"disabled"],["header","Agregar Impuesto",3,"visible","modal","draggable","resizable","visibleChange"],["formControlName","impuesto_id","optionLabel","nombre","placeholder","Buscar Impuesto",1,"dropdown-custom",3,"options","autoDisplayFirst"],["pButton","","pRipple","","label","Agregar Impuesto","icon","pi pi-fw","type","submit",1,"w-full","bg-admin","boder-admin","mb-5","border-round-3xl",3,"disabled"],["icon","pi pi-trash","severity","danger",3,"click"],["colspan","3"],[1,"flex","align-items-center"],[1,"ml-2"],[2,"color","red"]],template:function(o,i){1&o&&(e._UZ(0,"ngx-spinner",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"div",4),e._UZ(6,"button",5),e.TgZ(7,"div",6),e._uU(8," Detalle de Receta "),e.qZA()(),e.TgZ(9,"form",7),e._UZ(10,"br"),e.TgZ(11,"div",8)(12,"div",9)(13,"label"),e._uU(14,"Nombre de Receta"),e.qZA(),e._UZ(15,"input",10),e.qZA(),e.TgZ(16,"div",11)(17,"label"),e._uU(18," Precio "),e.qZA(),e._UZ(19,"input",12),e.qZA(),e.TgZ(20,"div",13)(21,"label"),e._uU(22,"Descripcion"),e.qZA(),e._UZ(23,"textarea",14),e.qZA()()()()()()(),e.TgZ(24,"div",15)(25,"p-tabView",16)(26,"p-tabPanel",17)(27,"div",18)(28,"div",3)(29,"div")(30,"div",19)(31,"button",20),e.NdJ("click",function(){return i.openModal()}),e.qZA(),e._uU(32," Agregar Producto "),e.qZA()(),e.TgZ(33,"div",21)(34,"button",22),e.NdJ("click",function(){return i.sendProducts()}),e.qZA()()()(),e.TgZ(35,"div",23)(36,"div",24)(37,"div",25)(38,"p-table",26),e.YNc(39,ae,11,0,"ng-template",27),e.YNc(40,ne,11,4,"ng-template",28),e.YNc(41,ce,3,0,"ng-template",29),e.qZA()()()()(),e.TgZ(42,"p-tabPanel",30),e._UZ(43,"ngx-spinner",0),e.TgZ(44,"div",18)(45,"div",3)(46,"div")(47,"div",19)(48,"button",20),e.NdJ("click",function(){return i.openModalTaxes()}),e.qZA(),e._uU(49," Agregar Impuesto "),e.qZA()(),e.TgZ(50,"div",21)(51,"button",31),e.NdJ("click",function(){return i.sendTaxes()}),e.qZA()()()(),e.TgZ(52,"div",23)(53,"div",24)(54,"div",25)(55,"p-table",26),e.YNc(56,pe,7,0,"ng-template",27),e.YNc(57,le,7,2,"ng-template",28),e.YNc(58,de,3,0,"ng-template",29),e.qZA()()()()()()(),e.TgZ(59,"p-dialog",32),e.NdJ("visibleChange",function(p){return i.displayModalProducts=p}),e.TgZ(60,"div",24)(61,"form",33),e.NdJ("ngSubmit",function(){return i.agregarProductos()}),e.TgZ(62,"div",8)(63,"div",13)(64,"label"),e._uU(65,"Producto"),e.qZA(),e.TgZ(66,"p-dropdown",34),e.YNc(67,ue,3,1,"ng-template",35),e.qZA(),e.YNc(68,me,2,0,"div",36),e.qZA(),e.TgZ(69,"div",13)(70,"label"),e._uU(71,"Cantidad"),e.qZA(),e.TgZ(72,"input",37),e.NdJ("change",function(p){return i.onCantidadChange(p)}),e.qZA(),e.YNc(73,ge,2,0,"div",36),e.YNc(74,he,2,0,"div",36),e.qZA(),e.TgZ(75,"div",13),e._UZ(76,"button",38),e.qZA()(),e._UZ(77,"br"),e.qZA()()(),e.TgZ(78,"p-dialog",39),e.NdJ("visibleChange",function(p){return i.displayModalTaxes=p}),e.TgZ(79,"div",24)(80,"form",33),e.NdJ("ngSubmit",function(){return i.agregarImpuestos()}),e.TgZ(81,"div",8)(82,"div",13)(83,"label"),e._uU(84,"Impuesto"),e.qZA(),e.TgZ(85,"p-dropdown",40),e.YNc(86,fe,3,1,"ng-template",35),e.qZA(),e.YNc(87,be,2,0,"div",36),e.qZA(),e.TgZ(88,"div",13),e._UZ(89,"button",41),e.qZA()(),e._UZ(90,"br"),e.qZA()()()),2&o&&(e.Q6J("fullScreen",!0),e.xp6(6),e.Q6J("routerLink","/dashboard/admin/recipes"),e.xp6(3),e.Q6J("formGroup",i.form),e.xp6(29),e.Q6J("value",i.productosParaMostrar)("tableStyle",e.DdM(36,U))("loading",i.loadingTable)("rows",8),e.xp6(5),e.Q6J("fullScreen",!0),e.xp6(12),e.Q6J("value",i.impuestosParaMostrar)("tableStyle",e.DdM(37,U))("loading",i.loadingTable)("rows",8),e.xp6(4),e.Akn(e.DdM(38,I)),e.Q6J("visible",i.displayModalProducts)("modal",!0)("draggable",!1)("resizable",!1),e.xp6(2),e.Q6J("formGroup",i.formProducto),e.xp6(5),e.Q6J("options",i.productsData)("autoDisplayFirst",!1),e.xp6(2),e.Q6J("ngIf",i.formProducto.get("producto_id").hasError("required")),e.xp6(5),e.Q6J("ngIf",i.formProducto.get("cantidad").hasError("required")),e.xp6(1),e.Q6J("ngIf",null==i.formProducto.get("cantidad").errors?null:i.formProducto.get("cantidad").errors.min),e.xp6(2),e.Q6J("disabled",i.formProducto.invalid),e.xp6(2),e.Akn(e.DdM(39,I)),e.Q6J("visible",i.displayModalTaxes)("modal",!0)("draggable",!1)("resizable",!1),e.xp6(2),e.Q6J("formGroup",i.formImpuesto),e.xp6(5),e.Q6J("options",i.taxesData)("autoDisplayFirst",!1),e.xp6(2),e.Q6J("ngIf",i.formImpuesto.get("impuesto_id").hasError("required")),e.xp6(2),e.Q6J("disabled",i.formImpuesto.invalid))},dependencies:[g.O5,d.rH,h.iA,P.jx,u.Hq,u.zx,c._Y,c.Fj,c.wV,c.JJ,c.JL,c.qQ,f.H,b.o,_.g,v.Lt,T.V,c.sg,c.u,m.Ro,C.xf,C.x4],styles:["svg[_ngcontent-%COMP%]{width:45%}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dddddd;text-align:left;padding:8px}th[_ngcontent-%COMP%]{background-color:#f2f2f2}"]})}return s})();var y=a(2506);let ve=(()=>{class s{static#e=this.\u0275fac=function(o){return new(o||s)};static#t=this.\u0275mod=e.oAB({type:s});static#i=this.\u0275inj=e.cJS({imports:[d.Bz.forChild([{path:"",component:re,canActivate:[y.a],data:{permissions:["gestionInventario.recetas"]}},{path:":id/recipes-products",component:_e,canActivate:[y.a],data:{permissions:["gestionInventario.recetas"]}}]),d.Bz]})}return s})();var Te=a(1712),Ze=a(4055);let xe=(()=>{class s{static#e=this.\u0275fac=function(o){return new(o||s)};static#t=this.\u0275mod=e.oAB({type:s});static#i=this.\u0275inj=e.cJS({providers:[{provide:Z.TP,useClass:G.n,multi:!0},R],imports:[g.ez,ve,h.U$,J.O,c.u5,u.hJ,f.T,N.EV,M.V,S.Xt,b.j,_.A,v.kW,w.cc,E.L$,T.S,F.ii.forRoot(),c.UX,m.ef,Te.U,Ze.q4,C.LU]})}return s})()}}]);