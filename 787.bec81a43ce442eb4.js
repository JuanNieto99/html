"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[787],{9787:(Z,m,n)=>{n.r(m),n.d(m,{ConfigHotelModule:()=>it});var A=n(6814),p=n(9664),s=n(95),u=n(707),L=n(4480),S=n(4104),T=n(6340),x=n(6022),U=n(3714),b=n(6218),M=n(2160),J=n(1865),H=n(354),G=n(7213),D=n(5722),R=n(8672),y=n(1712),j=n(4055),F=n(4844),q=n(6208),_=n(228),P=n(3519),h=n.n(P),t=n(4946),C=n(9862),Q=n(4444);let N=(()=>{class i{constructor(e){this.httpClient=e,this.baseUrl=Q.D.url,this.endpointListar="/configuracionesListar",this.endpointCreate="/configuraciones",this.endpointUpdate="/configuraciones/",this.endpointDelete="/configuraciones/"}createHttpOptions(){let e=JSON.parse(localStorage.getItem("currentUser")).token;return{headers:new C.WM({"Content-Type":"application/json",Authorization:`Bearer ${e}`})}}getAllConfigurations(){return this.httpClient.post(`${this.baseUrl}${this.endpointListar}`,{},this.createHttpOptions())}createConfig(e){return this.httpClient.post(`${this.baseUrl}${this.endpointCreate}`,e,this.createHttpOptions())}updateConfig(e,r){return this.httpClient.post(`${this.baseUrl}${this.endpointUpdate}${e}`,r,this.createHttpOptions())}deleteConfig(e){return this.httpClient.delete(`${this.baseUrl}${this.endpointDelete}${e}`,this.createHttpOptions())}static#t=this.\u0275fac=function(r){return new(r||i)(t.LFG(C.eN))};static#o=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function Y(i,g){1&i&&(t.TgZ(0,"div",26),t._uU(1,"El campo es requerido"),t.qZA())}function V(i,g){1&i&&(t.TgZ(0,"div",26),t._uU(1,"M\xe1ximo 100 caracteres"),t.qZA())}function $(i,g){1&i&&(t.TgZ(0,"div",26),t._uU(1,"El campo es requerido"),t.qZA())}function B(i,g){1&i&&(t.TgZ(0,"div",26),t._uU(1,"M\xe1ximo 100 caracteres"),t.qZA())}function K(i,g){1&i&&(t.TgZ(0,"div",26),t._uU(1,"El campo es requerido"),t.qZA())}function W(i,g){1&i&&(t.TgZ(0,"div",26),t._uU(1,"El campo es requerido"),t.qZA())}function z(i,g){1&i&&(t.TgZ(0,"div",26),t._uU(1,"El campo es requerido"),t.qZA())}function X(i,g){1&i&&(t.TgZ(0,"div",26),t._uU(1,"El campo es requerido"),t.qZA())}function k(i,g){1&i&&(t.TgZ(0,"div",26),t._uU(1,"El campo es requerido"),t.qZA())}let E=(()=>{class i{constructor(e,r,a){this.FB=e,this.spinner=r,this.configHotelService=a,this.configIds={}}ngOnInit(){this.buildForms(),this.loadConfigurations()}buildForms(){this.configFormTRA=this.FB.group({TOKEN_TARGETA_REGISTRO_ALOJAMIENTO:["",s.kI.maxLength(100)],REGISTRO_NACIONAL_DE_TURISMO:["",s.kI.maxLength(100)]}),this.configFormFactura=this.FB.group({URL_ENVIAR_FACTURAS:["",[s.kI.required,s.kI.maxLength(255)]],FACTURAS_USER_NAME:["",[s.kI.required,s.kI.maxLength(50)]],FACTURAS_USER_PASSWORD:["",[s.kI.required,s.kI.maxLength(50)]],FACTURAS_RESOLUCION:["",[s.kI.required,s.kI.maxLength(50)]],FACTURAS_FOLIO:["",[s.kI.required,s.kI.maxLength(50)]]})}loadConfigurations(){this.spinner.show(),this.configHotelService.getAllConfigurations().subscribe(e=>{this.spinner.hide(),e.forEach(r=>{r.codigo_configuracion in this.configFormTRA.controls?(this.configFormTRA.patchValue({[r.codigo_configuracion]:r.valor}),this.configIds[r.codigo_configuracion]=r.id):r.codigo_configuracion in this.configFormFactura.controls&&(this.configFormFactura.patchValue({[r.codigo_configuracion]:r.valor}),this.configIds[r.codigo_configuracion]=r.id)})},e=>{this.spinner.hide(),console.error("Error al cargar configuraciones:",e)})}isTRAFormValid(){return this.configFormTRA.get("TOKEN_TARGETA_REGISTRO_ALOJAMIENTO")?.value.trim()||this.configFormTRA.get("REGISTRO_NACIONAL_DE_TURISMO")?.value.trim()}onSaveTRA(){const e=this.configFormTRA.value,r=Object.keys(e).filter(o=>e[o]?.trim()).map(o=>({codigo_configuracion:o,valor:e[o]})),a=Object.keys(this.configIds).filter(o=>o in this.configFormTRA.controls&&!e[o]?.trim()&&null!==this.configIds[o]).map(o=>this.configIds[o]),d=[...r.map(o=>this.configIds[o.codigo_configuracion]?this.configHotelService.updateConfig(this.configIds[o.codigo_configuracion],o):this.configHotelService.createConfig(o)),...a.map(o=>this.configHotelService.deleteConfig(o))];d.length>0&&(this.spinner.show(),Promise.all(d.map(o=>o.toPromise())).then(o=>{this.spinner.hide(),h().fire("\xc9xito","Configuraci\xf3n TRA actualizada correctamente","success"),o.forEach((c,l)=>{c?.id&&(this.configIds[r[l].codigo_configuracion]=c.id)}),a.forEach(c=>{const l=Object.keys(this.configIds).find(O=>this.configIds[O]===c);l&&(this.configIds[l]=null)})},o=>{this.spinner.hide(),h().fire("Error","Hubo un problema al guardar la configuraci\xf3n TRA","error")}))}onSaveFactura(){const e=this.configFormFactura.value,r=Object.keys(e).filter(o=>e[o]?.trim()).map(o=>({codigo_configuracion:o,valor:e[o]})),a=Object.keys(this.configIds).filter(o=>o in this.configFormFactura.controls&&!e[o]?.trim()&&null!==this.configIds[o]).map(o=>this.configIds[o]),d=[...r.map(o=>this.configIds[o.codigo_configuracion]?this.configHotelService.updateConfig(this.configIds[o.codigo_configuracion],o):this.configHotelService.createConfig(o)),...a.map(o=>this.configHotelService.deleteConfig(o))];d.length>0&&(this.spinner.show(),Promise.all(d.map(o=>o.toPromise())).then(o=>{this.spinner.hide(),h().fire("\xc9xito","Configuraci\xf3n de Facturaci\xf3n guardada correctamente","success"),o.forEach((c,l)=>{c?.id&&(this.configIds[r[l].codigo_configuracion]=c.id)}),a.forEach(c=>{const l=Object.keys(this.configIds).find(O=>this.configIds[O]===c);l&&(this.configIds[l]=null)})},o=>{this.spinner.hide(),h().fire("Error","Hubo un problema al guardar la configuraci\xf3n de Facturaci\xf3n","error")}))}static#t=this.\u0275fac=function(r){return new(r||i)(t.Y36(s.qu),t.Y36(R.t2),t.Y36(N))};static#o=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-config-hotel"]],decls:56,vars:14,consts:[["type","ball-scale-multiple",3,"fullScreen"],[1,"card","m-1"],["orientation","left"],["header","Configuraci\xf3n TRA",1,"line-height-3","m-0"],[1,"surface-section","px-2","pt-3","md:px-6","lg:px-8"],[1,"flex","align-items-center","justify-content-between","font-medium","text-3xl","text-900"],["label","Guardar",3,"disabled","click"],[1,"mt-3",3,"formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12"],["for","TOKEN_TARGETA_REGISTRO_ALOJAMIENTO"],["id","TOKEN_TARGETA_REGISTRO_ALOJAMIENTO","formControlName","TOKEN_TARGETA_REGISTRO_ALOJAMIENTO","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["style","color: red;",4,"ngIf"],["for","REGISTRO_NACIONAL_DE_TURISMO"],["id","REGISTRO_NACIONAL_DE_TURISMO","formControlName","REGISTRO_NACIONAL_DE_TURISMO","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["header","Configuraci\xf3n Facturaci\xf3n Electr\xf3nica",1,"line-height-3","m-0"],["for","URL_ENVIAR_FACTURAS"],["id","URL_ENVIAR_FACTURAS","formControlName","URL_ENVIAR_FACTURAS","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["for","FACTURAS_USER_NAME"],["id","FACTURAS_USER_NAME","formControlName","FACTURAS_USER_NAME","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["for","FACTURAS_USER_PASSWORD"],["id","FACTURAS_USER_PASSWORD","formControlName","FACTURAS_USER_PASSWORD","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["for","FACTURAS_RESOLUCION"],["id","FACTURAS_RESOLUCION","formControlName","FACTURAS_RESOLUCION","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],["for","FACTURAS_FOLIO"],["id","FACTURAS_FOLIO","formControlName","FACTURAS_FOLIO","type","text","pInputText","",1,"w-full","mb-3","border-round-3xl"],[2,"color","red"]],template:function(r,a){1&r&&(t._UZ(0,"ngx-spinner",0),t.TgZ(1,"div",1)(2,"p-tabView",2)(3,"p-tabPanel",3)(4,"div",4)(5,"div",5)(6,"span"),t._uU(7,"Configuraci\xf3n de Tarjeta de Registro de Alojamiento"),t.qZA(),t.TgZ(8,"p-button",6),t.NdJ("click",function(){return a.onSaveTRA()}),t.qZA()(),t.TgZ(9,"form",7)(10,"div",8)(11,"div",9)(12,"label",10),t._uU(13,"Tarjeta de Registro de Alojamiento"),t.qZA(),t._UZ(14,"input",11),t.YNc(15,Y,2,0,"div",12),t.YNc(16,V,2,0,"div",12),t.qZA(),t.TgZ(17,"div",9)(18,"label",13),t._uU(19,"Registro Nacional de Turismo"),t.qZA(),t._UZ(20,"input",14),t.YNc(21,$,2,0,"div",12),t.YNc(22,B,2,0,"div",12),t.qZA()()()()(),t.TgZ(23,"p-tabPanel",15)(24,"div",4)(25,"div",5)(26,"span"),t._uU(27,"Configuraci\xf3n de facturaci\xf3n electr\xf3nica"),t.qZA(),t.TgZ(28,"p-button",6),t.NdJ("click",function(){return a.onSaveFactura()}),t.qZA()(),t.TgZ(29,"form",7)(30,"div",8)(31,"div",9)(32,"label",16),t._uU(33,"URL Enviar Facturas"),t.qZA(),t._UZ(34,"input",17),t.YNc(35,K,2,0,"div",12),t.qZA(),t.TgZ(36,"div",9)(37,"label",18),t._uU(38,"Nombre de Usuario"),t.qZA(),t._UZ(39,"input",19),t.YNc(40,W,2,0,"div",12),t.qZA(),t.TgZ(41,"div",9)(42,"label",20),t._uU(43,"Contrase\xf1a de Usuario"),t.qZA(),t._UZ(44,"input",21),t.YNc(45,z,2,0,"div",12),t.qZA(),t.TgZ(46,"div",9)(47,"label",22),t._uU(48,"Resoluci\xf3n"),t.qZA(),t._UZ(49,"input",23),t.YNc(50,X,2,0,"div",12),t.qZA(),t.TgZ(51,"div",9)(52,"label",24),t._uU(53,"Folio"),t.qZA(),t._UZ(54,"input",25),t.YNc(55,k,2,0,"div",12),t.qZA()()()()()()()),2&r&&(t.Q6J("fullScreen",!0),t.xp6(8),t.Q6J("disabled",!a.isTRAFormValid()),t.xp6(1),t.Q6J("formGroup",a.configFormTRA),t.xp6(6),t.Q6J("ngIf",a.configFormTRA.get("TOKEN_TARGETA_REGISTRO_ALOJAMIENTO").hasError("required")&&a.configFormTRA.get("TOKEN_TARGETA_REGISTRO_ALOJAMIENTO").touched),t.xp6(1),t.Q6J("ngIf",a.configFormTRA.get("TOKEN_TARGETA_REGISTRO_ALOJAMIENTO").hasError("maxlength")),t.xp6(5),t.Q6J("ngIf",a.configFormTRA.get("REGISTRO_NACIONAL_DE_TURISMO").hasError("required")&&a.configFormTRA.get("REGISTRO_NACIONAL_DE_TURISMO").touched),t.xp6(1),t.Q6J("ngIf",a.configFormTRA.get("REGISTRO_NACIONAL_DE_TURISMO").hasError("maxlength")),t.xp6(6),t.Q6J("disabled",!a.configFormFactura.valid),t.xp6(1),t.Q6J("formGroup",a.configFormFactura),t.xp6(6),t.Q6J("ngIf",a.configFormFactura.get("URL_ENVIAR_FACTURAS").hasError("required")&&a.configFormFactura.get("URL_ENVIAR_FACTURAS").touched),t.xp6(5),t.Q6J("ngIf",a.configFormFactura.get("FACTURAS_USER_NAME").hasError("required")&&a.configFormFactura.get("FACTURAS_USER_NAME").touched),t.xp6(5),t.Q6J("ngIf",a.configFormFactura.get("FACTURAS_USER_PASSWORD").hasError("required")&&a.configFormFactura.get("FACTURAS_USER_PASSWORD").touched),t.xp6(5),t.Q6J("ngIf",a.configFormFactura.get("FACTURAS_RESOLUCION").hasError("required")&&a.configFormFactura.get("FACTURAS_RESOLUCION").touched),t.xp6(5),t.Q6J("ngIf",a.configFormFactura.get("FACTURAS_FOLIO").hasError("required")&&a.configFormFactura.get("FACTURAS_FOLIO").touched))},dependencies:[A.O5,s._Y,s.Fj,s.JJ,s.JL,u.zx,U.o,s.sg,s.u,R.Ro,F.xf,F.x4]})}return i})();var I=n(2506);const w=[{path:"",component:E,canActivate:[I.a],data:{permissions:["administracion.hotelconfiguracion"]}},{path:"crear",component:E,canActivate:[I.a],data:{permissions:["administracion.hotelconfiguracion.crear"]}},{path:":id/edit",component:E,canActivate:[I.a],data:{permissions:["administracion.hotelconfiguracion"]}}];let tt=(()=>{class i{static#t=this.\u0275fac=function(r){return new(r||i)};static#o=this.\u0275mod=t.oAB({type:i});static#i=this.\u0275inj=t.cJS({imports:[_.Bz.forChild(w),_.Bz]})}return i})();var ot=n(8712);let it=(()=>{class i{static#t=this.\u0275fac=function(r){return new(r||i)};static#o=this.\u0275mod=t.oAB({type:i});static#i=this.\u0275inj=t.cJS({providers:[{provide:C.TP,useClass:ot.n,multi:!0},N],imports:[A.ez,tt,p.U$,s.u5,u.hJ,L.T,S.EV,T.V,x.Xt,U.j,b.A,M.kW,J.cc,H.L$,G.S,D.ii.forRoot(),s.UX,R.ef,y.U,j.q4,F.LU,q.m]})}return i})()},6208:(Z,m,n)=>{n.d(m,{m:()=>s});var A=n(6814),p=n(4946);let s=(()=>{class u{static#t=this.\u0275fac=function(T){return new(T||u)};static#o=this.\u0275mod=p.oAB({type:u});static#i=this.\u0275inj=p.cJS({imports:[A.ez]})}return u})()}}]);